<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>å±€éƒ¨è®Šæ›´åµæ¸¬èˆ‡ Angular Signals åœ¨æ¨¡æ¿ä¸­çš„è©³ç´°æ‡‰ç”¨ â€º ç¿»è­¯è’Ÿè’»</title>
  <meta name="author" content="Brian">
  
  <meta name="description" content="æ¨™é¡Œï¼šæ·±å…¥æ¢è¨ Local Change Detection å’Œ Angular Signals åœ¨æ¨¡æ¿ä¸­çš„æ‡‰ç”¨åŸæ–‡ï¼šhttps://medium.com/angularwave/local-change-detection-and-angular-signals-in-templates-in-details-948283adc36d
å¤§å®¶å¥½ ğŸ‘‹ï¼è®“æˆ‘å€‘ç¹¼çºŒæ¢è¨ Angular Signals ç³»çµ±åŠå…¶å…§éƒ¨é‹ä½œåŸç† ğŸ”ã€‚ä»¥ä¸‹æ˜¯æ–‡ç« ç›®éŒ„ï¼Œæ–¹ä¾¿æ‚¨å¿«é€Ÿå°èˆªï¼š

Introduction to Angular Signals
Deep dive into the Angular Signals: Part 1
Deep dive into the Angular Signals: Part 2
Effect: what is it and how does it work?

ä»Šå¤©ï¼Œè®“æˆ‘å€‘ä¾†è«‡è«‡ä¸€å€‹å›  Angular Signals è€Œå¯¦ç¾çš„é©šäººç‰¹æ€§ â€” local change detectionã€‚æˆ‘éå¸¸æœŸå¾…èˆ‡æ‚¨åˆ†äº«é€™ä¸€åˆ‡ã€‚é€™æ˜¯ä¸€å€‹å¼•äººå…¥å‹çš„ä¸»é¡Œï¼Œæˆ‘å°æ­¤æ„Ÿåˆ°éå¸¸èˆˆå¥®ã€‚å¹¾å¤©å‰ï¼Œæˆ‘åœ¨æ¨ç‰¹ä¸Šç™¼å¸ƒäº†ç›¸é—œå…§å®¹ã€‚é€™äº›æ¨æ–‡ç°¡è¦åœ°æè¿°äº† Angular Signals çš„é‹ä½œæ–¹å¼ã€‚æˆ‘è¿«ä¸åŠå¾…åœ°æƒ³åˆ†äº«æ›´å¤šç´°ç¯€ï¼">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="å±€éƒ¨è®Šæ›´åµæ¸¬èˆ‡ Angular Signals åœ¨æ¨¡æ¿ä¸­çš„è©³ç´°æ‡‰ç”¨"/>
  <meta property="og:site_name" content="ç¿»è­¯è’Ÿè’»"/>

  
    <meta property="og:image" content=""/>
  

  <link href="/TranslationKonjac/favicon.png" rel="icon">
  <link rel="alternate" href="/TranslationKonjac/atom.xml" title="ç¿»è­¯è’Ÿè’»" type="application/atom+xml">
  <link rel="stylesheet" href="/TranslationKonjac/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  <header id="header"><div class="meta inner">
  <h1><a href="/TranslationKonjac/">ç¿»è­¯è’Ÿè’»</a></h1>
  <h2><a href="/TranslationKonjac/"></a></h2>
  <nav id="main-nav">
    <ul>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
</div>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title">å±€éƒ¨è®Šæ›´åµæ¸¬èˆ‡ Angular Signals åœ¨æ¨¡æ¿ä¸­çš„è©³ç´°æ‡‰ç”¨</h1>
  

      
        <time datetime="2025-01-20T09:11:56.000Z">2025-01-20</time>
      
    </header>
    <div class="entry">
      
        <h1 id="æ¨™é¡Œï¼šæ·±å…¥æ¢è¨-Local-Change-Detection-å’Œ-Angular-Signals-åœ¨æ¨¡æ¿ä¸­çš„æ‡‰ç”¨"><a href="#æ¨™é¡Œï¼šæ·±å…¥æ¢è¨-Local-Change-Detection-å’Œ-Angular-Signals-åœ¨æ¨¡æ¿ä¸­çš„æ‡‰ç”¨" class="headerlink" title="æ¨™é¡Œï¼šæ·±å…¥æ¢è¨ Local Change Detection å’Œ Angular Signals åœ¨æ¨¡æ¿ä¸­çš„æ‡‰ç”¨"></a>æ¨™é¡Œï¼šæ·±å…¥æ¢è¨ Local Change Detection å’Œ Angular Signals åœ¨æ¨¡æ¿ä¸­çš„æ‡‰ç”¨</h1><p>åŸæ–‡ï¼š<a target="_blank" rel="noopener" href="https://medium.com/angularwave/local-change-detection-and-angular-signals-in-templates-in-details-948283adc36d">https://medium.com/angularwave/local-change-detection-and-angular-signals-in-templates-in-details-948283adc36d</a></p>
<p>å¤§å®¶å¥½ ğŸ‘‹ï¼è®“æˆ‘å€‘ç¹¼çºŒæ¢è¨ Angular Signals ç³»çµ±åŠå…¶å…§éƒ¨é‹ä½œåŸç† ğŸ”ã€‚ä»¥ä¸‹æ˜¯æ–‡ç« ç›®éŒ„ï¼Œæ–¹ä¾¿æ‚¨å¿«é€Ÿå°èˆªï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://medium.com/angularwave/introduction-to-angular-signals-e20dba5737db">Introduction to Angular Signals</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/angularwave/deep-dive-into-the-angular-signals-part-1-c6f9c62aea0e">Deep dive into the Angular Signals: Part 1</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/angularwave/deep-dive-into-the-angular-signals-part-2-274c08c42ca0">Deep dive into the Angular Signals: Part 2</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/p/9778788a40bc">Effect: what is it and how does it work?</a></li>
</ul>
<p>ä»Šå¤©ï¼Œè®“æˆ‘å€‘ä¾†è«‡è«‡ä¸€å€‹å›  Angular Signals è€Œå¯¦ç¾çš„é©šäººç‰¹æ€§ â€” local change detectionã€‚æˆ‘éå¸¸æœŸå¾…èˆ‡æ‚¨åˆ†äº«é€™ä¸€åˆ‡ã€‚é€™æ˜¯ä¸€å€‹å¼•äººå…¥å‹çš„ä¸»é¡Œï¼Œæˆ‘å°æ­¤æ„Ÿåˆ°éå¸¸èˆˆå¥®ã€‚å¹¾å¤©å‰ï¼Œ<a target="_blank" rel="noopener" href="https://x.com/sharikov_vlad/status/1731023880641491303?s=20">æˆ‘åœ¨æ¨ç‰¹ä¸Šç™¼å¸ƒäº†ç›¸é—œå…§å®¹</a>ã€‚é€™äº›æ¨æ–‡ç°¡è¦åœ°æè¿°äº† Angular Signals çš„é‹ä½œæ–¹å¼ã€‚æˆ‘è¿«ä¸åŠå¾…åœ°æƒ³åˆ†äº«æ›´å¤šç´°ç¯€ï¼</p>
<span id="more"></span>

<p><img src="https://miro.medium.com/v2/resize:fit:700/0*aRPk8IXYXy9ayPkQ" alt="Image 29"></p>
<p>ç›®å‰å·²æœ‰ä¸€ç¨®é—œæ–¼ change detection çš„å·¥ä½œæ–¹å¼ï¼Œå®ƒçš„é€Ÿåº¦å·²ç¶“ç›¸ç•¶å¿«äº†ã€‚è€Œæœ‰äº† signalsï¼ŒAngular å¯ä»¥åªæª¢æŸ¥å¿…è¦çš„çµ„ä»¶ï¼Œå¾è€Œå¯ä»¥ç”¨æ›´å°‘çš„å·¥ä½œé‡ä¾†é”æˆç›¸åŒçš„çµæœã€‚</p>
<blockquote>
<p>Angular change detection å·²ç¶“å¾ˆå¿«äº†ã€‚æœ‰äº† Angular Signalsï¼Œå®ƒçš„é€Ÿåº¦å°‡å¦‚åŒé–ƒé›»èˆ¬è¿…é€Ÿ ğŸš€ğŸš€ğŸš€ã€‚å› ç‚ºç¾åœ¨å®ƒå¯ä»¥åœ¨åŸ·è¡Œ change detection æ™‚æ›´å…·é‡å°æ€§ã€‚</p>
</blockquote>
<p>å¦‚å‰æ‰€è¿°ï¼ŒAngular Signals èˆ‡å…¶ä»–éŸ¿æ‡‰å¼ç³»çµ±æœ‰è¨±å¤šå…±é€šä¹‹è™•ã€‚é€™äº›å·¥å…·ä¸­ä½¿ç”¨çš„é€šç”¨æ–¹æ³•åç¨±æ˜¯ fine-grained reactivityã€‚ä½¿ç”¨é€™æ¨£çš„å·¥å…·å¯ä»¥è®“ Angular åªåŸ·è¡Œå¿…è¦çš„æ“ä½œã€‚è®“æˆ‘å€‘è©³ç´°äº†è§£ä¸€ä¸‹é€™åœ¨ Angular ä¸­æ˜¯å¦‚ä½•å¯¦ç¾çš„ã€‚æˆ‘å°‡æŒ‰ç…§ä»¥ä¸‹æ–¹å¼çµ„ç¹”é€™ç¯‡æ–‡ç« ï¼š</p>
<ul>
<li>è§£é‡‹ç”¨æ–¼è¨è«–æ­¤ä¸»é¡Œçš„ç¯„ä¾‹</li>
<li>ç°¡è¿°ï¼šç›®å‰çš„ change detection å¦‚ä½•é‹ä½œï¼Ÿ</li>
<li>ç•¶æ‚¨åœ¨çµ„ä»¶çš„æ¨¡æ¿ä¸­ä½¿ç”¨ signal æ™‚æœƒç™¼ç”Ÿä»€éº¼ï¼Œä»¥åŠ Angular å¦‚ä½•è¿½è¹¤å®ƒï¼Ÿ</li>
<li>Angular å¦‚ä½•ç²¾ç¢ºåœ°å¯¦ç¾ local change detectionï¼Ÿ</li>
</ul>
<h2 id="é‡é»ç¸½çµ"><a href="#é‡é»ç¸½çµ" class="headerlink" title="é‡é»ç¸½çµ"></a>é‡é»ç¸½çµ</h2><ul>
<li>âœ… ä½¿ç”¨ Signalsï¼ŒAngular å¯ä»¥æª¢æŸ¥æ›´å°‘çš„ view ä¸¦æ›´å¿«åœ°åŸ·è¡Œ change detectionã€‚</li>
<li>âœ… ç¾åœ¨ï¼Œæ¯å€‹ viewï¼ˆå¤§è‡´ä¸Šæ¯å€‹çµ„ä»¶ï¼‰éƒ½æœ‰ä¸€å€‹å°æ‡‰çš„ signalã€‚</li>
<li>âœ… é€™å€‹ signal å°±åƒä¸€å€‹ computed signal æˆ– effectï¼Œå®ƒå¯ä»¥è¿½è¹¤çµ„ä»¶ä¸­ä½¿ç”¨çš„ signalï¼Œä¸¦åœ¨å…¶ç™¼ç”Ÿè®ŠåŒ–æ™‚èª¿ç”¨æŸäº›é‚è¼¯ã€‚</li>
<li>âœ… ç•¶ä»»ä½• signal ç™¼ç”Ÿè®ŠåŒ–æ™‚ï¼Œview çš„ç¥–å…ˆæœƒè¢«æ¨™è¨˜ä¸€å€‹ç‰¹æ®Šçš„æ¨™èªŒï¼Œé€™æœ‰åŠ©æ–¼ Angular é€²è¡Œ change detection éç¨‹ã€‚</li>
<li>âœ… ç•¶ä»»ä½• signal ç™¼ç”Ÿè®ŠåŒ–æ™‚ï¼Œview å°æ‡‰çš„ signal æœƒè¢«æ¨™è¨˜ï¼Œé€™ç‚º Angular æä¾›äº†å¿…é ˆæª¢æŸ¥å…¶è®ŠåŒ–çš„è³‡è¨Šã€‚</li>
<li>âœ… åº•å±¤æœ‰ä¸€å€‹éŸ¿æ‡‰å¼åœ–ã€‚å®ƒå…è¨± signals ä¹‹é–“ç›¸äº’é€šè¨Šã€‚è©²æ©Ÿåˆ¶ä½¿ Angular èƒ½å¤ å¯¦ç¾ Local change detecitonã€‚</li>
</ul>
<h2 id="ç¯„ä¾‹"><a href="#ç¯„ä¾‹" class="headerlink" title="ç¯„ä¾‹"></a>ç¯„ä¾‹</h2><p>æˆ‘å°‡åœ¨ä»¥ä¸‹ç¯„ä¾‹ä¸­è¨è«–é€™å€‹ä¸»é¡Œã€‚æ‚¨å¯ä»¥åœ¨ <a target="_blank" rel="noopener" href="https://stackblitz.com/edit/stackblitz-starters-hjwued?devToolsHeight=33&file=src/main.ts">Stackblitz ä¸ŠæŸ¥çœ‹</a>ã€‚é€™æ˜¯ä¸€å€‹å…·æœ‰æ ¹çµ„ä»¶çš„æ‡‰ç”¨ç¨‹å¼ï¼Œå®ƒæ¸²æŸ“ä¸€å€‹ä¸­é–“å±¤çµ„ä»¶ã€‚ä¸­é–“å±¤çµ„ä»¶æœƒå¤šæ¬¡æ¸²æŸ“è‡ªèº«ï¼Œæœ€å¾Œæ¸²æŸ“ä¸€å€‹ç›®æ¨™çµ„ä»¶ã€‚ç›®æ¨™çµ„ä»¶æœ‰ä¸€å€‹å°‡è¦è¢«æ”¹è®Šçš„ç‹€æ…‹ã€‚æ­¤å¤–ï¼Œç‚ºäº†è¦–è¦ºåŒ– change detection éç¨‹ï¼Œæˆ‘æ·»åŠ äº† <code>visualizeCd</code> getter ä¸¦å°‡å…¶æ”¾åœ¨æ¨¡æ¿ä¸­ã€‚å®ƒè¼¸å‡ºä¸€å€‹ç©ºå­—ç¬¦ä¸²ï¼Œä½†å®ƒä¹Ÿä½¿ç”¨ <code>console.log</code> ä¾†é¡¯ç¤ºæ¨¡æ¿å·²è¢«è¨ªå•ã€‚ä¸­é–“å±¤çµ„ä»¶è¼¸å‡ºè¨ªå•çš„äº‹å¯¦ä¸¦ç”¨å®ƒå€‘çš„ <code>depth</code> æ¨™è¨˜å®ƒã€‚ç›®æ¨™çµ„ä»¶ä¹ŸåŸ·è¡Œç›¸åŒçš„æ“ä½œä¸¦å°å…¶é€²è¡Œæ¨™è¨˜ã€‚éœ€è¦é€™äº› getter ä¾†äº†è§£å“ªäº›ç¢ºåˆ‡çš„çµ„ä»¶è¢«è¨ªå•ã€‚</p>
<p>åœ¨é€™å€‹ç¯„ä¾‹ä¸­ï¼Œæˆ‘è©¦åœ–æ›´æ¥è¿‘ä¸€å€‹å…·æœ‰è¨±å¤šçµ„ä»¶çš„ã€ŒçœŸå¯¦ä¸–ç•Œã€æ‡‰ç”¨ç¨‹å¼ã€‚åœ¨çœŸå¯¦ä¸–ç•Œçš„æ‡‰ç”¨ç¨‹å¼ä¸­ï¼Œæ‚¨é€šå¸¸æ“æœ‰å¤§é‡çµ„ä»¶ã€‚å®ƒå€‘å°±åƒä¸€æ£µæœ‰å¾ˆå¤šæ¨¹æå’Œæ¨¹è‘‰çš„æ¨¹ã€‚Angular åœ¨åº•å±¤ä¹Ÿæœ‰é€™æ¨£ä¸€æ£µæ¨¹ï¼Œä¸¦ä¸”å®ƒæœƒä½¿ç”¨å®ƒã€‚</p>
<p><a target="_blank" rel="noopener" href="https://twitter.com/Jean__Meche"><strong>Matthieu Riegler</strong></a> é–‹ç™¼äº†<a target="_blank" rel="noopener" href="https://twitter.com/Jean__Meche/status/1728599408734851245">ä¸€å€‹å¾ˆæ£’çš„å·¥å…·</a>ï¼Œå¯ä»¥å¹«åŠ©æ‚¨äº†è§£ change detection åœ¨ä¸åŒæ¨¡å¼ä¸‹çš„é‹ä½œæ–¹å¼ã€‚å®ƒæœƒé¡¯ç¤ºå“ªäº›çµ„ä»¶è¢«æª¢æŸ¥ã€‚ä½¿ç”¨å³å´åˆ†æ”¯ä¸¦åœ¨è©²çµ„ä»¶ä¸­åŸ·è¡Œæ¨™è¨˜æª¢æŸ¥å’Œ&#x2F;æˆ– signal æ›´æ”¹ä»¥æŸ¥çœ‹å·®ç•°ï¼š</p>
<p><img src="https://miro.medium.com/v2/resize:fit:448/1*JDe_vNa5ZYRlgGzjDjl1WA.png" alt="Image 30"></p>
<p>æ‚¨å¯ä»¥åœ¨ view ä¸Šçœ‹åˆ°è«¸å¦‚ HasChildViewsToRefresh æˆ– Dirty æˆ– <code>Consumer dirty</code> ä¹‹é¡çš„æ¨™èªŒã€‚è¦åœ¨çµ„ä»¶ä¸ŠåŸ·è¡Œæ“ä½œå¾Œæ¨¡æ“¬ change detectionï¼Œè«‹åŸ·è¡Œ <code>AppRef.tick()</code>ã€‚æ‚¨å°‡çœ‹åˆ° Angular å¦‚ä½•æª¢æŸ¥ viewã€‚é€™äº›æ¨™èªŒæ˜¯ä»€éº¼æ„æ€ï¼ŒAngular å¦‚ä½•çŸ¥é“è¦æª¢æŸ¥ä»€éº¼ï¼Ÿè®“æˆ‘å€‘ä¾†è©³ç´°èªªæ˜ã€‚æˆ‘å€‘å…ˆä¾†çœ‹çœ‹å®ƒç¾åœ¨æ˜¯å¦‚ä½•é‹ä½œçš„ã€‚</p>
<h2 id="ç›®å‰çš„-Change-Detection-å¦‚ä½•é‹ä½œï¼Ÿ"><a href="#ç›®å‰çš„-Change-Detection-å¦‚ä½•é‹ä½œï¼Ÿ" class="headerlink" title="ç›®å‰çš„ Change Detection å¦‚ä½•é‹ä½œï¼Ÿ"></a>ç›®å‰çš„ Change Detection å¦‚ä½•é‹ä½œï¼Ÿ</h2><p>åœ¨é€™è£¡ï¼Œæˆ‘å°‡ç°¡è¦æ¦‚è¿°å®ƒçš„é‹ä½œåŸç†ã€‚é€™æ˜¯å› ç‚ºæ‚¨å¯ä»¥æ’°å¯«ä¸æ­¢ä¸€ç¯‡é—œæ–¼ change detection æ©Ÿåˆ¶æœ¬èº«çš„æ–‡ç« ã€‚å·²ç¶“æœ‰å¹¾ç¯‡é—œæ–¼å®ƒçš„æ–‡ç« ï¼Œå› æ­¤å¦‚æœæ‚¨æœ‰èˆˆè¶£ï¼Œå¯ä»¥æŸ¥çœ‹å®ƒå€‘ï¼ˆ<a target="_blank" rel="noopener" href="https://medium.com/angularwave/onpush-your-new-default-ba3fd5bc9f6e">ç¯„ä¾‹</a>ï¼‰ã€‚åœ¨ Angular å…§éƒ¨ï¼Œæœ‰ä¸åŒçš„çµæ§‹ä¾†ç¶­è­·æ¡†æ¶ä¸­ç™¼ç”Ÿçš„æ‰€æœ‰äº‹æƒ…ã€‚æœ‰ä¸€çµ„ viewã€‚å¦‚æœæ‚¨ç°¡åŒ–ï¼ˆæˆ‘åœ¨é€™å€‹ç¯„ä¾‹ä¸­å°±æ˜¯é€™æ¨£åšçš„ï¼‰ï¼Œæ‚¨å¯ä»¥èªªæ‡‰ç”¨ç¨‹å¼ä¸­çš„æ¯å€‹çµ„ä»¶éƒ½æœ‰ä¸€å€‹ viewã€‚æ‰€æœ‰é€™äº› view å½¢æˆä¸€å€‹æ¨¹ç‹€çµæ§‹ã€‚Angular ä½¿ç”¨è©²çµæ§‹ä¾†åŸ·è¡Œ change detectionã€‚view åŒ…å«æœ‰é—œçµ„ä»¶çš„å¤§é‡æŠ€è¡“è³‡è¨Šï¼Œä¸¦åœ¨åŸ·è¡Œä¸åŒæ“ä½œæ™‚ä½¿ç”¨è©²è³‡è¨Šã€‚æ‚¨å¯ä»¥å°‡ view è¦–ç‚ºåŒ…å«å¤§é‡è³‡è¨Šçš„å®¹å™¨ï¼Œä¾‹å¦‚è¼¸å…¥çš„ç•¶å‰ç‹€æ…‹ã€æ¨¡æ¿ã€æŒ‡ä»¤ã€ç•¶å‰ç¶å®šç‹€æ…‹ç­‰ã€‚Angular æ“ä½œé€™äº› viewï¼Œè€Œä¸æ˜¯çµ„ä»¶ã€‚</p>
<p>change detection æœ‰å…©å€‹éƒ¨åˆ†ã€‚ç¬¬ä¸€éƒ¨åˆ†æ˜¯ change detection æ‡‰è©²ä»¥æŸç¨®æ–¹å¼å•Ÿå‹•ã€‚é€™å°±æ˜¯ <code>zone.js</code> ç™¼æ®ä½œç”¨çš„æ™‚å€™ã€‚å®ƒè¿½è¹¤æ‰€æœ‰é€™äº›å¥‡ç‰¹çš„éåŒæ­¥ç€è¦½å™¨äº‹ä»¶ï¼ˆä¾‹å¦‚ XHRã€DOM äº‹ä»¶ã€<code>setInterval</code>ã€<code>setTimeout</code> ç­‰ï¼‰ï¼Œä¸¦å…è¨±æ‚¨ç²å¾—æœ‰é—œæŸäº›éåŒæ­¥äº‹ä»¶ç™¼ç”Ÿçš„é€šçŸ¥ã€‚Angular æœ‰ä¸€å€‹ <code>NgZone</code> æ¨¡çµ„ï¼Œå®ƒä½¿ç”¨ <code>zone.js</code> ä¾†è¿½è¹¤æ­¤é¡éåŒæ­¥äº’å‹•ã€‚ç•¶ç™¼ç”ŸéåŒæ­¥äº‹ä»¶æ™‚ï¼Œchange detection æœƒè¢«è§¸ç™¼ï¼ŒAngular æœƒéæ­· view çš„æ¨¹ã€‚æ‚¨å¯ä»¥åœ¨ <a target="_blank" rel="noopener" href="https://github.com/angular/angular/blob/21741384f46012f7e8cdbab03281b664b9b954cb/packages/core/src/application_ref.ts#L1237-L1243">Angular çš„æ ¸å¿ƒ</a>ä¸­æ‰¾åˆ°è©²ç¨‹å¼ç¢¼ã€‚å®ƒé–‹å§‹æ¨¹çš„éæ­·ã€‚ç¬¬äºŒéƒ¨åˆ†æ˜¯åœ¨ change detection æœŸé–“æ‡‰è©²æª¢æŸ¥çš„å…§å®¹ã€‚</p>
<p>Angular åŸ·è¡Œ change detection æœ‰å…©ç¨®ç­–ç•¥ã€‚å®ƒå¯ä»¥æ˜¯ <code>OnPush</code> æˆ– <code>Default</code> ç­–ç•¥ã€‚åœ¨é è¨­æƒ…æ³ä¸‹ï¼Œå®ƒæœƒéæ­·æ¨¹ä¸¦è¨ªå•æ¯å€‹ viewã€‚</p>
<p>ä½¿ç”¨ <code>OnPush</code> å„ªåŒ–ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼æ›´ç²¾ç´°ï¼Œä½†ä»ç„¶å¾ˆå»£æ³›ã€‚åœ¨å¯¦éš›æ‡‰ç”¨ç¨‹å¼ä¸­ï¼Œæ‚¨ä¸æœƒåƒæˆ‘åœ¨ç›¸å°ç°¡å–®çš„ç¯„ä¾‹ä¸­é‚£æ¨£æ“æœ‰ä¸€æ£µåªæœ‰ä¸€å€‹åˆ†æ”¯çš„ view æ¨¹ã€‚æ‚¨æœ‰å¾ˆå¤šåˆ†æ”¯ã€‚<code>OnPush</code> ç­–ç•¥å…è¨±æ¡†æ¶åˆ‡æ–·æ•´å€‹ view åˆ†æ”¯è€Œä¸æª¢æŸ¥å®ƒå€‘ã€‚é€™ä½¿å¾—æ‡‰ç”¨ç¨‹å¼çš„æ•ˆèƒ½æ›´é«˜ã€‚</p>
<blockquote>
<p>æœ‰å…©ç¨® ChangeDetection ç­–ç•¥ã€‚åœ¨é è¨­æƒ…æ³ä¸‹ï¼Œæ¯å€‹ view éƒ½æœƒåœ¨ change detection æœŸé–“è¢«æª¢æŸ¥ã€‚åœ¨ <code>OnPush</code> æƒ…æ³ä¸‹ï¼Œåªæœ‰è¢«æ¨™è¨˜çš„ view æ‰æœƒåœ¨ change detection æœŸé–“è¢«æª¢æŸ¥ã€‚</p>
</blockquote>
<p>åœ¨ OnPush ç­–ç•¥ä¸­ï¼Œåªæœ‰ã€Œæ¨™è¨˜ã€çš„ view æœƒè¢«æª¢æŸ¥ã€‚æœ‰å¹¾ç¨®æ–¹æ³•å¯ä»¥æ¨™è¨˜çµ„ä»¶ä»¥é€²è¡Œæª¢æŸ¥ï¼šè¼¸å…¥ç¶å®šç™¼ç”Ÿè®ŠåŒ–ã€äº‹ä»¶åµè½å™¨è§¸ç™¼æˆ–èª¿ç”¨äº† <code>ChangeDetectoRef</code> ä¸­çš„ <code>markForCheck</code>ã€‚</p>
<blockquote>
<p>è¦åœ¨ OnPush ä¸­æ¨™è¨˜è¦æ›´æ–°çš„çµ„ä»¶ï¼Œæ‚¨éœ€è¦æ›´æ”¹è¼¸å…¥ã€è§¸ç™¼äº‹ä»¶ï¼ˆæˆ–å¾è¼¸å‡ºä¸­ç™¼å‡ºï¼‰æˆ–æ‰‹å‹•èª¿ç”¨ markForCheckï¼ˆAsyncPipe åŸ·è¡Œç›¸åŒçš„æ“ä½œï¼‰</p>
</blockquote>
<p>åœ¨æˆ‘çš„ç¯„ä¾‹ä¸­ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ <code>OnPush</code> ç­–ç•¥ï¼Œå› æ­¤å¯¦éš›ä¸Šï¼Œæ‡‰ç”¨ç¨‹å¼å·²ç¶“é€²è¡Œäº†ç›¸ç•¶çš„å„ªåŒ–ã€‚æˆ‘æƒ³å°‡é€™ç¨®æ–¹æ³•èˆ‡ä½¿ç”¨ signals çš„æ–°æ–¹æ³•é€²è¡Œæ¯”è¼ƒã€‚å‡ºæ–¼ç¤ºç¯„ç›®çš„ï¼Œæˆ‘åœ¨ç¯„ä¾‹ä¸­ä½¿ç”¨äº† <code>markForCheck</code> æ–¹æ³•ã€‚æ‚¨å¯ä»¥åœ¨ <code>TargetComponent</code> çš„ <code>ngOnInit</code> ä¸­çœ‹åˆ°å®ƒï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;app-target&#x27;</span>,</span><br><span class="line">  <span class="attr">standalone</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`state: &#123;&#123; state &#125;&#125; &#123;&#123; visualizeCd &#125;&#125;`</span>,</span><br><span class="line">  <span class="attr">changeDetection</span>: <span class="title class_">ChangeDetectionStrategy</span>.<span class="property">OnPush</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">TargetComponent</span> &#123;</span><br><span class="line">  state = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> cdr = <span class="title function_">inject</span>(<span class="title class_">ChangeDetectorRef</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">ngOnInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&gt;&gt; change state&#x27;</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">state</span> += <span class="number">1</span>;</span><br><span class="line">      <span class="comment">// ğŸ‘‡</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">cdr</span>.<span class="title function_">markForCheck</span>();</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">visualizeCd</span>() &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&gt;&gt; cd happened in target&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>markForCheck</code> èª¿ç”¨æœƒæ¨™è¨˜ç•¶å‰ view åŠå…¶æ‰€æœ‰çˆ¶ viewï¼Œç›´åˆ°æ ¹ view ä»¥é€²è¡Œæª¢æŸ¥ã€‚è®“æˆ‘å€‘å°‡å…¶è¦–è¦ºåŒ–ã€‚ç•¶å‰çš„æ ¹çµ„ä»¶å’Œä¸­é–“å±¤çµ„ä»¶çš„æ¨¡æ¿æ˜¯ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- app-root --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">app-mid</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- app-mid --&gt;</span></span><br><span class="line">&#123;&#123; visualizeCd &#125;&#125;</span><br><span class="line">@if (depth &lt; 5) &#123;</span><br><span class="line">  <span class="tag">&lt;<span class="name">app-mid</span> [<span class="attr">depth</span>]=<span class="string">&quot;depth + 1&quot;</span> /&gt;</span></span><br><span class="line">&#125; @else &#123;</span><br><span class="line">  <span class="tag">&lt;<span class="name">app-target</span> /&gt;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€™æœƒç”¢ç”Ÿå¦‚ä¸‹æ‰€ç¤ºçš„æ¨¹ï¼š</p>
<p><img src="https://miro.medium.com/v2/resize:fit:700/1*SwnoXgTmJZWkUPno58eTfg.png" alt="Image 31"></p>
<p>å¦‚æœæ‚¨å°‡æ ¹çµ„ä»¶æ›´æ”¹ç‚ºä»¥ä¸‹å…§å®¹ï¼Œæœƒç™¼ç”Ÿä»€éº¼ï¼Ÿ</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- root --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">app-mid</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">app-mid</span> [<span class="attr">logicIsDisabled</span>]=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>è®“æˆ‘å€‘å‡è¨­ <code>app-mid</code> çµ„ä»¶æœ‰é€™æ¨£çš„è¼¸å…¥ä¸¦å°‡å…¶å‘ä¸‹å‚³éçµ¦å­çµ„ä»¶ï¼Œç›´åˆ°ç›®æ¨™çµ„ä»¶ã€‚å¦‚æœè©²è¼¸å…¥ç‚º <code>true</code>ï¼Œå‰‡ç›®æ¨™çµ„ä»¶ä¸­çš„ç‹€æ…‹æ ¹æœ¬ä¸æœƒæ›´æ”¹ï¼Œä¸¦ä¸” view å°‡ä¸æœƒè¢«æ¨™è¨˜ç‚ºéœ€è¦æª¢æŸ¥ã€‚view çš„æ¨¹å°‡å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://miro.medium.com/v2/resize:fit:700/1*NMIBCzH7_e35eSwutcYGmg.png" alt="Image 32"></p>
<p>ç¾åœ¨ï¼Œç¬¬äºŒå€‹åˆ†æ”¯å·²ç¦ç”¨æ›´æ”¹ã€‚è®“æˆ‘å€‘æª¢æŸ¥ä¸€ä¸‹åœ¨ç‹€æ…‹æ›´æ”¹å¾Œèª¿ç”¨ <code>markForCheck</code> æ™‚æœƒç™¼ç”Ÿä»€éº¼ã€‚<code>app-target</code> view è¢«æ¨™è¨˜ç‚ºéœ€è¦æª¢æŸ¥ã€‚æ­¤å¤–ï¼Œå®ƒé‚„æœƒæ¨™è¨˜æ‰€æœ‰çˆ¶ view ä»¥é€²è¡Œæª¢æŸ¥ï¼Œç›´åˆ°æ ¹ viewã€‚ä»¥ä¸‹æ˜¯ç™¼ç”Ÿçš„æƒ…æ³ï¼š</p>
<p><img src="https://miro.medium.com/v2/resize:fit:700/1*mb4MZvz9uhy56m_u5VnSaw.png" alt="Image 33"></p>
<p>ç¾åœ¨ï¼Œç”±æ–¼ <code>setTimeout</code> æ˜¯ä¸€å€‹éåŒæ­¥æ“ä½œï¼Œä¸¦ä¸” <code>zone.js</code> æœƒè¿½è¹¤å®ƒã€‚Angular è§¸ç™¼ change detection ä¸¦ä¸”åƒ…æª¢æŸ¥ç¶ è‰²çš„ viewã€‚</p>
<p>åœ¨ change detection æœŸé–“ç©¶ç«Ÿç™¼ç”Ÿäº†ä»€éº¼ï¼Ÿæ¯å€‹ view éƒ½åŒ…å«å°çµ„ä»¶æ¨¡æ¿å‡½æ•¸çš„å¼•ç”¨ã€‚æ¯å€‹çµ„ä»¶éƒ½æœ‰ä¸€å€‹æ¨¡æ¿ã€‚åœ¨æ§‹å»ºæœŸé–“ï¼Œé€™äº›çµ„ä»¶æœƒè¢«ç·¨è­¯æˆ JavaScript å‡½æ•¸ã€‚ä»¥ä¸‹æ˜¯<a target="_blank" rel="noopener" href="https://github.com/angular/angular/blob/21741384f4/packages/core/src/render3/VIEW_DATA.md?plain=1#L90-L109">è©²å‡½æ•¸çš„ç¯„ä¾‹ï¼ˆä¾†è‡ª Angular ç¨‹å¼ç¢¼ä¸­çš„æŸäº› READMEï¼‰</a>ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>(<span class="params"><span class="attr">rf</span>: <span class="title class_">RenderFlags</span>, <span class="attr">ctx</span>: <span class="title class_">MyApp</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (rf &amp; <span class="title class_">RenderFlags</span>.<span class="property">Create</span>) &#123;</span><br><span class="line">    ÉµÉµ<span class="title function_">elementStart</span>(<span class="number">0</span>, <span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">    ÉµÉµ<span class="title function_">text</span>(<span class="number">1</span>);</span><br><span class="line">    ÉµÉµ<span class="title function_">elementEnd</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (rf &amp; <span class="title class_">RenderFlags</span>.<span class="property">Update</span>) &#123;</span><br><span class="line">    ÉµÉµ<span class="title function_">property</span>(<span class="string">&#x27;title&#x27;</span>, ctx.<span class="property">name</span>);</span><br><span class="line">    ÉµÉµ<span class="title function_">advance</span>(<span class="number">1</span>);</span><br><span class="line">    ÉµÉµ<span class="title function_">textInterpolate1</span>(<span class="string">&#x27;Hello &#x27;</span>, ctx.<span class="property">name</span>, <span class="string">&#x27;!&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¾åœ¨ï¼Œç‚ºäº†åŸ·è¡Œ change detectionï¼ŒAngular æœƒè¨ªå•æ¯å€‹ viewï¼Œå¦‚æœå®ƒè¢«æ¨™è¨˜ç‚ºéœ€è¦æª¢æŸ¥ï¼Œå®ƒæœƒåŸ·è¡Œè©²çµ„ä»¶çš„æ¨¡æ¿å‡½æ•¸ã€‚ç¾åœ¨ï¼Œå®ƒå°‡æ–°å€¼èˆ‡å…ˆå‰è¨ˆç®—çš„å€¼é€²è¡Œæ¯”è¼ƒï¼Œå¦‚æœå­˜åœ¨å·®ç•°ï¼ŒAngular æœƒæ¸²æŸ“æ›´æ”¹ã€‚</p>
<blockquote>
<p>ç‚ºäº†åŸ·è¡Œ change detectionï¼ŒAngular æœƒéæ­· view çš„æ¨¹ä¸¦åœ¨<strong>æ¯å€‹</strong>çµ„ä»¶ä¸ŠåŸ·è¡Œæ¨¡æ¿å‡½æ•¸ã€‚</p>
</blockquote>
<p>è®“æˆ‘å€‘æª¢æŸ¥ä¸€ä¸‹æˆ‘åœ¨ä¹‹å‰æä¾›çš„ç¯„ä¾‹ä¸­ç™¼ç”Ÿäº†ä»€éº¼ï¼Œæ‚¨å°±æœƒæ˜ç™½ç‚ºä»€éº¼éœ€è¦ <code>visualizeCd</code> è¼”åŠ©å‡½æ•¸ï¼š</p>
<p><img src="https://miro.medium.com/v2/resize:fit:700/1*BMblzGAZucqCzkFvfsxs5w.png" alt="Image 34"></p>
<p>æ‚¨å¯ä»¥çœ‹åˆ° <code>cd happened</code> æ—¥èªŒåœ¨ <code>change state</code> æ—¥èªŒä¹‹å‰å‡ºç¾äº†å¾ˆå¤šæ¬¡ã€‚å®ƒæœƒé‡å° <code>MidLayerComponent</code> çš„æ¯å€‹å¯¦ä¾‹å‡ºç¾ä¸€æ¬¡ï¼Œé‡å° <code>TargetComponent</code> å‡ºç¾ä¸€æ¬¡ã€‚æ›´æ”¹ç‹€æ…‹å¾Œï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æ—¥èªŒå‡ºç¾çš„æ¬¡æ•¸ç›¸åŒã€‚é€™è¡¨ç¤ºåœ¨æ¯å€‹çµ„ä»¶ä¸Šéƒ½èª¿ç”¨äº† <code>visualizeCd</code>ã€‚ç¾åœ¨æœ‰æ„ç¾©äº†å—ï¼Ÿé€™èˆ‡ä¸Šè¿°å…§å®¹ç›¸é—œã€‚æ•´å€‹ view åˆ†æ”¯éƒ½è¢«æ¨™è¨˜ç‚ºéœ€è¦æª¢æŸ¥ã€‚Angular é€šéç‚ºæ¯å€‹ view åŸ·è¡Œæ¨¡æ¿å‡½æ•¸ä¾†æª¢æŸ¥æ¯å€‹çµ„ä»¶ã€‚</p>
<blockquote>
<p>åœ¨ OnPush æƒ…æ³ä¸‹ï¼Œæ¨¡æ¿æœƒåœ¨æ¯å€‹è¢«æ¨™è¨˜çš„ view ä¸ŠåŸ·è¡Œã€‚</p>
</blockquote>
<p>é€™å°±æ˜¯ç•¶å‰çš„ change detection ä¸–ç•Œã€‚åˆ¥å¿˜äº†æˆ‘åœ¨ä¸Šé¢æä¾›çš„ç”¨æ–¼æª¢æŸ¥ change detection å¦‚ä½•é‹ä½œçš„ç¤ºç¯„ã€‚æ‚¨å¯ä»¥æª¢æŸ¥ OnPush ç™¼ç”Ÿäº†ä»€éº¼ä¸¦å°‡å…¶èˆ‡ Angular Signals é€²è¡Œæ¯”è¼ƒã€‚ç¾åœ¨ï¼Œè®“æˆ‘å€‘å›é¡§ä¸€ä¸‹ Angular Signals ç™¼ç”Ÿäº†ä»€éº¼ä»¥åŠç‚ºä»€éº¼ã€‚</p>
<h2 id="Angular-Signals-å¦‚ä½•æ”¹è®Šäº†é€™ä¸€é»ï¼Ÿ"><a href="#Angular-Signals-å¦‚ä½•æ”¹è®Šäº†é€™ä¸€é»ï¼Ÿ" class="headerlink" title="Angular Signals å¦‚ä½•æ”¹è®Šäº†é€™ä¸€é»ï¼Ÿ"></a>Angular Signals å¦‚ä½•æ”¹è®Šäº†é€™ä¸€é»ï¼Ÿ</h2><p>è®“æˆ‘å€‘ç¹¼çºŒçœ‹<a target="_blank" rel="noopener" href="https://stackblitz.com/edit/stackblitz-starters-rwh9sp?devToolsHeight=33&file=src/main.ts">ç¬¬äºŒå€‹ç¯„ä¾‹</a>ï¼Œæˆ‘åœ¨å…¶ä¸­ä½¿ç”¨ signals è€Œä¸æ˜¯ç°¡å–®çš„è®Šæ•¸ã€‚ç›®æ¨™çµ„ä»¶çš„ç¨‹å¼ç¢¼ç•¥æœ‰æ›´æ”¹ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;app-target&#x27;</span>,</span><br><span class="line">  <span class="attr">standalone</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`state: &#123;&#123; state() &#125;&#125; &#123;&#123; visualizeCd &#125;&#125;`</span>,</span><br><span class="line">  <span class="attr">changeDetection</span>: <span class="title class_">ChangeDetectionStrategy</span>.<span class="property">OnPush</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">TargetComponent</span> &#123;</span><br><span class="line">  state = <span class="title function_">signal</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">ngOnInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&gt;&gt; change state&#x27;</span>);</span><br><span class="line">      <span class="comment">// ğŸ‘‡ no markForCheck</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">state</span>.<span class="title function_">update</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> v + <span class="number">1</span>);</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">visualizeCd</span>() &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&gt;&gt; cd happened in target&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€™æ˜¯ä¸€å€‹éå¸¸ç°¡å–®çš„æ›´æ”¹ï¼Œä½†å®ƒå¸¶ä¾†äº†å¾ˆå¤šå¥½è™• ğŸ¤©ï¼æ‚¨å¯ä»¥çœ‹åˆ°ç¾åœ¨ <code>state</code> å¯¦ä¾‹æˆå“¡å·²æ›´æ”¹ç‚º signalã€‚å®ƒä»¥å‰æ˜¯ä¸€å€‹ç°¡å–®çš„è®Šæ•¸ï¼Œç¾åœ¨è®Šæˆäº†ä¸€å€‹ signalã€‚æ­¤å¤–ï¼Œåœ¨ <code>ngOnInit</code> å‡½æ•¸ä¸­ï¼Œæˆ‘ä½¿ç”¨ <code>this.state.update</code> è€Œä¸æ˜¯ç°¡å–®çš„ <code>this.state += 1</code>ã€‚è«‹æ³¨æ„ï¼Œç¾åœ¨æ²’æœ‰ <code>markForCheck</code> èª¿ç”¨ã€‚æ­¤å¤–ï¼Œåœ¨æ¨¡æ¿ä¸­ï¼Œæˆ‘ä½¿ç”¨äº† <code>state()</code>ã€‚å¦‚æœæ‚¨æƒ³ç²å– signal å€¼ï¼Œæ‚¨éœ€è¦èª¿ç”¨ä¸€å€‹å‡½æ•¸ã€‚è©²ç¨‹å¼ç¢¼å¯ä»¥æ­£å¸¸é‹ä½œã€‚</p>
<p>åœ¨è€ƒæ…®å°‡ç¯„ä¾‹é·ç§»åˆ° signals æ™‚ï¼Œè®“æˆ‘å€‘è€ƒæ…®ä»¥ä¸‹å•é¡Œï¼š</p>
<ul>
<li>â“ ç•¶æ‚¨å°‡ signal æ”¾å…¥ Angular çµ„ä»¶çš„æ¨¡æ¿ä¸­æ™‚æœƒç™¼ç”Ÿä»€éº¼ï¼Ÿ</li>
<li>â“ç•¶æ¨¡æ¿ä¸­ä½¿ç”¨çš„ signal ç™¼ç”Ÿæ›´æ”¹æ™‚æœƒç™¼ç”Ÿä»€éº¼ï¼Ÿ</li>
<li>â“å…¨åŸŸ change detection å‚³æ’­æ©Ÿåˆ¶æ˜¯å¦‚ä½•æ›´æ”¹çš„ï¼Ÿ</li>
</ul>
<p>è®“æˆ‘å€‘åˆ†è§£ä¸€ä¸‹åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨è©² signal æ™‚åœ¨æŠ€è¡“ä¸Šç™¼ç”Ÿäº†ä»€éº¼ã€‚é€™å€‹ signal æ˜¯çµ„ä»¶æ¨¡æ¿çš„ä¸€éƒ¨åˆ†ã€‚å¾ä¸Šä¸€ç¯€ä¸­ï¼Œæ‚¨çŸ¥é“åœ¨åº•å±¤ï¼ŒAngular æ“ä½œ view å’Œæ¨¡æ¿å‡½æ•¸ã€‚æœ€å¾Œï¼Œ<code>state: &#123;&#123; state() &#125;&#125; &#123;&#123; visualizeCd &#125;&#125;</code> æ¨¡æ¿å°‡è®Šæˆä¸€å€‹æ¨¡æ¿å‡½æ•¸ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">TargetComponent_Template</span>(<span class="params">rf, ctx</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (rf &amp; <span class="number">1</span>) &#123;</span><br><span class="line">    ÉµÉµ<span class="title function_">text</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (rf &amp; <span class="number">2</span>) &#123;</span><br><span class="line">                                           ğŸ‘‡</span><br><span class="line">    ÉµÉµ<span class="title function_">textInterpolate2</span>(<span class="string">&quot;state: &quot;</span>, ctx.<span class="title function_">state</span>(), <span class="string">&quot; &quot;</span>, ctx.<span class="property">visualizeCd</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>rf &amp; 1</code> ä»£è¡¨å‰µå»ºï¼Œ<code>rf &amp; 2</code> éƒ¨åˆ†ä»£è¡¨æ›´æ–°ã€‚é€™è¡¨ç¤ºå®ƒåœ¨ä»»ä½•æ›´æ–°æœŸé–“éƒ½æœƒåŸ·è¡Œã€‚æ‰€ä»¥ï¼Œé€™æ˜¯ä¸€å€‹åŸºæœ¬çš„ JavaScript å‡½æ•¸ã€‚å¿…é ˆå¾æŸå€‹åœ°æ–¹èª¿ç”¨å®ƒã€‚é€™ç™¼ç”Ÿåœ¨ <a target="_blank" rel="noopener" href="https://github.com/angular/angular/blob/21741384f4/packages/core/src/render3/instructions/shared.ts#L261">executeTemplate</a> <a target="_blank" rel="noopener" href="https://github.com/angular/angular/blob/21741384f4/packages/core/src/render3/instructions/shared.ts#L261">å‡½æ•¸</a>ä¸­ï¼Œè©²å‡½æ•¸æ˜¯å¾ <a target="_blank" rel="noopener" href="https://github.com/angular/angular/blob/21741384f4/packages/core/src/render3/instructions/change_detection.ts#L158">refreshView</a> <a target="_blank" rel="noopener" href="https://github.com/angular/angular/blob/21741384f4/packages/core/src/render3/instructions/change_detection.ts#L158">å‡½æ•¸</a>ä¸­èª¿ç”¨çš„ã€‚è®“æˆ‘å€‘ä»”ç´°çœ‹çœ‹ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// render3/instructions/change_detection.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> refreshView&lt;T&gt;(<span class="attr">tView</span>: <span class="title class_">TView</span>, <span class="attr">lView</span>: <span class="title class_">LView</span>, <span class="attr">templateFn</span>: <span class="title class_">ComponentTemplate</span>&lt;&#123;&#125;&gt;|<span class="literal">null</span>, <span class="attr">context</span>: T) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">prevConsumer</span>: <span class="title class_">ReactiveNode</span>|<span class="literal">null</span> = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">currentConsumer</span>: <span class="title class_">ReactiveLViewConsumer</span>|<span class="literal">null</span> = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">if</span> (!isInCheckNoChangesPass &amp;&amp; <span class="title function_">viewShouldHaveReactiveConsumer</span>(tView)) &#123;</span><br><span class="line">    <span class="comment">// ğŸ‘‡ğŸ‘‡ğŸ‘‡</span></span><br><span class="line">    currentConsumer = <span class="title function_">getOrBorrowReactiveLViewConsumer</span>(lView);</span><br><span class="line">    prevConsumer = <span class="title function_">consumerBeforeComputation</span>(currentConsumer);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">if</span> (templateFn !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// ğŸ‘‡ğŸ‘‡ğŸ‘‡</span></span><br><span class="line">      <span class="title function_">executeTemplate</span>(tView, lView, templateFn, <span class="title class_">RenderFlags</span>.<span class="property">Update</span>, context);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ....</span></span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (currentConsumer !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// ğŸ‘‡ğŸ‘‡ğŸ‘‡</span></span><br><span class="line">      <span class="title function_">consumerAfterComputation</span>(currentConsumer, prevConsumer);</span><br><span class="line">      <span class="title function_">maybeReturnReactiveLViewConsumer</span>(currentConsumer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">leaveView</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// render3/reactive_lview_customer.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getOrBorrowReactiveLViewConsumer</span>(<span class="params"><span class="attr">lView</span>: <span class="title class_">LView</span></span>): <span class="title class_">ReactiveLViewConsumer</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> lView[<span class="variable constant_">REACTIVE_TEMPLATE_CONSUMER</span>] ?? <span class="title function_">borrowReactiveLViewConsumer</span>(lView);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">borrowReactiveLViewConsumer</span>(<span class="params"><span class="attr">lView</span>: <span class="title class_">LView</span></span>): <span class="title class_">ReactiveLViewConsumer</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">consumer</span>: <span class="title class_">ReactiveLViewConsumer</span> =</span><br><span class="line">      freeConsumers.<span class="title function_">pop</span>() ?? <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="variable constant_">REACTIVE_LVIEW_CONSUMER_NODE</span>);</span><br><span class="line">  <span class="comment">// ğŸ‘‡</span></span><br><span class="line">  consumer.<span class="property">lView</span> = lView;</span><br><span class="line">  <span class="keyword">return</span> consumer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">REACTIVE_LVIEW_CONSUMER_NODE</span>: <span class="title class_">Omit</span>&lt;<span class="title class_">ReactiveLViewConsumer</span>, <span class="string">&#x27;lView&#x27;</span>|<span class="string">&#x27;slot&#x27;</span>&gt; = &#123;</span><br><span class="line">  ...<span class="variable constant_">REACTIVE_NODE</span>,</span><br><span class="line">  <span class="comment">// ğŸ‘‡</span></span><br><span class="line">  <span class="attr">consumerIsAlwaysLive</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">consumerMarkDirty</span>: <span class="function">(<span class="params"><span class="attr">node</span>: <span class="title class_">ReactiveLViewConsumer</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ğŸ‘‡</span></span><br><span class="line">    <span class="title function_">markAncestorsForTraversal</span>(node.<span class="property">lView</span>!);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">consumerOnSignalRead</span>(<span class="attr">this</span>: <span class="title class_">ReactiveLViewConsumer</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">lView</span>![<span class="variable constant_">REACTIVE_TEMPLATE_CONSUMER</span>] = <span class="variable language_">this</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æœ‰å¾ˆå¤šç¨‹å¼ç¢¼ï¼Œä½†è«‹æ³¨æ„ä¸Šé¢çš„å¹¾è¡Œã€‚<code>currentConsumer = getOrBorrowReactiveLViewConsumer(lView)</code> ç²å–ç¾æœ‰çš„ <code>lView[REACTIVE_TEMPLATE_CONSUMER]</code> æˆ–åŸºæ–¼ <code>REACTIVE_LVIEW_CONSUMER_NODE</code> çµæ§‹å‰µå»ºä¸€å€‹æ–°çš„éŸ¿æ‡‰å¼ç¯€é»ã€‚å¦è«‹æ³¨æ„ï¼Œ<code>lView</code> å·²æ·»åŠ åˆ°å‰µå»ºçš„ consumer ä¸­ã€‚é€™æ˜¯ä¸€ä»¶é‡è¦çš„äº‹æƒ…ï¼Œå› ç‚ºå®ƒå°‡åœ¨ä»¥å¾Œä½¿ç”¨ã€‚</p>
<blockquote>
<p>æ¯å€‹ view éƒ½æœ‰ä¸€å€‹èˆ‡ä¹‹é—œè¯çš„éŸ¿æ‡‰å¼ç¯€é»</p>
</blockquote>
<p>å¦‚æœæ‚¨é–±è®€äº†ä¹‹å‰çš„æ–‡ç« ï¼Œé‚£éº¼ <code>prevConsumer = consumerBeforeComputation(currentConsumer);</code> å°æ‚¨ä¾†èªªæ‡‰è©²å¾ˆç†Ÿæ‚‰ã€‚é€™å°‡ä½¿ç”¨ <code>currentConsumer</code> è¨­ç½®ç•¶å‰çš„ <code>activeConsumer</code> ç‹€æ…‹ã€‚ä¹‹å¾Œï¼Œå°‡èª¿ç”¨ <code>executeTemplate</code>ï¼Œä¸¦åŸ·è¡Œå…¶ä¸­çš„æ¨¡æ¿å‡½æ•¸ã€‚åœ¨æ¨¡æ¿å‡½æ•¸ä¸­ï¼Œæœ‰ä¸€å€‹ <code>ctx.state()</code>ï¼Œè¡¨ç¤ºè¨ªå• signalã€‚ç¾åœ¨ï¼Œå°‡èª¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/angular/angular/blob/21741384f4/packages/core/primitives/signals/src/graph.ts#L199-L246">producerAccessed</a> <a target="_blank" rel="noopener" href="https://github.com/angular/angular/blob/21741384f4/packages/core/primitives/signals/src/graph.ts#L199-L246">å‡½æ•¸</a>ï¼Œåœ¨è©²å‡½æ•¸ä¸­å°‡å‰µå»ºå…©å€‹éŸ¿æ‡‰å¼ç¯€é»ä¹‹é–“çš„é€£çµã€‚è«‹æŸ¥çœ‹ä¹‹å‰çš„æ–‡ç« ï¼Œæˆ‘åœ¨å…¶ä¸­è©³ç´°è§£é‡‹äº†é€™ä¸€é»ã€‚å®ƒä½æ–¼ <a target="_blank" rel="noopener" href="https://medium.com/angularwave/deep-dive-into-the-angular-signals-part-1-c6f9c62aea0e">Deep dive into the Angular Signals: Part 1</a> ä¸­çš„<strong>å»¶é²è©•ä¼°å’Œè‡ªå‹•ä¾è³´é …åœ–</strong>éƒ¨åˆ†ã€‚è®“æˆ‘å€‘ç°¡è¦åœ°æª¢æŸ¥ä¸€ä¸‹ï¼Œå› ç‚ºæ‚¨ç¾åœ¨å¯èƒ½æ²’æœ‰é–±è®€ä¹‹å‰çš„æ–‡ç« ï¼Œå¦‚æœæ˜¯çš„è©±ï¼Œé‡è¤‡å­¸ç¿’ä¹Ÿæ˜¯å¥½çš„ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">producerAccessed</span>(<span class="params"><span class="attr">node</span>: <span class="title class_">ReactiveNode</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">if</span> (activeConsumer.<span class="property">producerNode</span>[idx] !== node) &#123;</span><br><span class="line">    <span class="comment">// We&#x27;re a new dependency of the consumer (at `idx`).</span></span><br><span class="line">    activeConsumer.<span class="property">producerNode</span>[idx] = node;</span><br><span class="line">    <span class="comment">// If the active consumer is live, then add it as a live consumer. If not, then use 0 as a</span></span><br><span class="line">    <span class="comment">// placeholder value.</span></span><br><span class="line">    <span class="comment">// ğŸ‘‡</span></span><br><span class="line">    activeConsumer.<span class="property">producerIndexOfThis</span>[idx] =</span><br><span class="line">        <span class="title function_">consumerIsLive</span>(activeConsumer) ? <span class="title function_">producerAddLiveConsumer</span>(node, activeConsumer, idx) : <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  activeConsumer.<span class="property">producerLastReadVersion</span>[idx] = node.<span class="property">version</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">consumerIsLive</span>(<span class="params"><span class="attr">node</span>: <span class="title class_">ReactiveNode</span></span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> node.<span class="property">consumerIsAlwaysLive</span> || (node?.<span class="property">liveConsumerNode</span>?.<span class="property">length</span> ?? <span class="number">0</span>) &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°¡è€Œè¨€ä¹‹ï¼Œè©²æ–¹æ³•æœƒæ›´æ”¹ <code>activeConsumer</code>ï¼ˆçµ„ä»¶ view ä¸­çš„ consumerï¼‰ç¯€é»çš„ç‹€æ…‹ï¼Œä¸¦å°‡ç•¶å‰è¨ªå•çš„ç¯€é»ï¼ˆ<code>TargetComponent</code> ä¸­çš„ <code>state</code> signalï¼‰è¨»å†Šåˆ°å…¶ä¸­ã€‚æ­¤å¤–ï¼Œå¦‚æœ <code>activeConsumer</code> ç‚º liveï¼Œå‰‡å°‡èª¿ç”¨ <code>producerAddLiveConsumer</code>ï¼Œé€™æœƒå°‡ <code>activeConsumer</code> æ·»åŠ åˆ° <code>state</code> signal çš„ <code>liveConsumersNode</code> é™£åˆ—ä¸­ã€‚ç”±æ–¼åŸ·è¡Œçµ„ä»¶æ¨¡æ¿ä¹‹å‰å‰µå»ºçš„éŸ¿æ‡‰å¼ç¯€é»çš„é…ç½®ï¼Œ<code>activeConsumer</code> ç‚º liveã€‚è«‹æŸ¥çœ‹å‰é¢ç¨‹å¼ç¢¼å€å¡Šä¸­çš„ <code>REACTIVE_LVIEW_CONSUMER_NODE</code> å®šç¾©ã€‚</p>
<blockquote>
<p>view çš„éŸ¿æ‡‰å¼ç¯€é»æˆç‚ºçµ„ä»¶æ¨¡æ¿ä¸­è¨ªå•çš„æ¯å€‹ signal çš„ live consumerã€‚é€™èˆ‡ effect æˆ– computed signal éå¸¸ç›¸ä¼¼</p>
</blockquote>
<p>æ‰€ä»¥ï¼Œå†æ¬¡ç€è¦½æ‰€æœ‰é€™äº›å…§å®¹ã€‚åœ¨çµ„ä»¶æ¨¡æ¿ä¸­ä½¿ç”¨ signal æœƒç™¼ç”Ÿä»€éº¼ï¼š</p>
<ol>
<li>åœ¨åŸ·è¡Œæ¨¡æ¿ä¹‹å‰ï¼ŒAngular æœƒå‰µå»ºæˆ–ç²å–ç¾æœ‰çš„ view çš„éŸ¿æ‡‰å¼ consumerã€‚</li>
<li>å¦‚æœæ¨¡æ¿ä¸­å°‡æœ‰ signalsï¼Œå®ƒæœƒå°‡å…¶è¨­ç½®ç‚º <code>activeConsumer</code>ã€‚</li>
<li>Angular åŸ·è¡Œæ¨¡æ¿ä¸¦è¨ªå• signalã€‚</li>
<li>åœ¨å…§éƒ¨ï¼Œæœƒåœ¨ view çš„ consumer å’Œ <code>state</code> signal ä¹‹é–“å»ºç«‹ä¾è³´é …ã€‚</li>
<li>signal çš„å€¼æœƒè¿”å›åˆ°æ¨¡æ¿å‡½æ•¸ï¼Œä»¥ä¾¿å®ƒå¯ä»¥åœ¨ç€è¦½å™¨ä¸­è¼¸å‡ºå®ƒã€‚</li>
</ol>
<blockquote>
<p>ç•¶åŸ·è¡Œæ¨¡æ¿æ™‚ï¼Œæœƒåœ¨æ¨¡æ¿ä¸­è¨ªå•çš„æ‰€æœ‰ signals å’Œ view çš„éŸ¿æ‡‰å¼ç¯€é»ä¹‹é–“å»ºç«‹ä¾è³´é …ã€‚</p>
</blockquote>
<h2 id="Angular-å¦‚ä½•çŸ¥é“-signals-ä¸­çš„æ›´æ”¹ï¼Ÿ"><a href="#Angular-å¦‚ä½•çŸ¥é“-signals-ä¸­çš„æ›´æ”¹ï¼Ÿ" class="headerlink" title="Angular å¦‚ä½•çŸ¥é“ signals ä¸­çš„æ›´æ”¹ï¼Ÿ"></a>Angular å¦‚ä½•çŸ¥é“ signals ä¸­çš„æ›´æ”¹ï¼Ÿ</h2><p>é€™æ˜¯å› ç‚ºåœ¨ç¬¬ä¸€æ¬¡åŸ·è¡Œæ¨¡æ¿å‡½æ•¸å¾Œï¼Œåœ¨è©² signal å’Œ view çš„ consumer ä¹‹é–“å»ºç«‹äº†ä¾è³´é …ã€‚å®ƒå…è¨±éŸ¿æ‡‰å¼ç³»çµ±ç¯€é»é€²è¡Œé€šè¨Šã€‚ç•¶æ‚¨ä½¿ç”¨ <code>set</code> æˆ– <code>update</code> æ–¹æ³•æ›´æ–° signal æ™‚ï¼Œæœƒåœ¨å…§éƒ¨èª¿ç”¨ <code>signalSetFn</code> å‡½æ•¸ã€‚é€™æœƒå°è‡´ <a target="_blank" rel="noopener" href="https://github.com/angular/angular/blob/21741384f4/packages/core/primitives/signals/src/signal.ts#L109-L115">signalValueChanged</a> èª¿ç”¨ï¼Œé€²è€Œå°è‡´ <a target="_blank" rel="noopener" href="https://github.com/angular/angular/blob/21741384f4/packages/core/primitives/signals/src/graph.ts#L292-L309">producerNotifiesConsumers</a> èª¿ç”¨ã€‚è®“æˆ‘å€‘ä»”ç´°çœ‹çœ‹ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">producerNotifyConsumers</span>(<span class="params"><span class="attr">node</span>: <span class="title class_">ReactiveNode</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (node.<span class="property">liveConsumerNode</span> === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Prevent signal reads when we&#x27;re updating the graph</span></span><br><span class="line">  <span class="keyword">const</span> prev = inNotificationPhase;</span><br><span class="line">  inNotificationPhase = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> consumer <span class="keyword">of</span> node.<span class="property">liveConsumerNode</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!consumer.<span class="property">dirty</span>) &#123;</span><br><span class="line">        <span class="comment">// ğŸ‘‡</span></span><br><span class="line">        <span class="title function_">consumerMarkDirty</span>(consumer);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    inNotificationPhase = prev;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">consumerMarkDirty</span>(<span class="params"><span class="attr">node</span>: <span class="title class_">ReactiveNode</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="comment">// ğŸ‘‡</span></span><br><span class="line">  node.<span class="property">dirty</span> = <span class="literal">true</span>;</span><br><span class="line">  <span class="title function_">producerNotifyConsumers</span>(node);</span><br><span class="line">  <span class="comment">// ğŸ‘‡</span></span><br><span class="line">  node.<span class="property">consumerMarkedDirty</span>?.(node);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è©²å‡½æ•¸æœƒéæ­· <code>node</code> çš„ <code>liveConsumerNode</code> é™£åˆ—ã€‚å¦‚æœå®ƒç‚º dirtyï¼Œå‰‡æœƒèª¿ç”¨ <code>consumerMarkDirty</code> å‡½æ•¸ã€‚å®ƒå°‡ç¯€é»è¨­ç½®ç‚º dirtyï¼Œéè¿´èª¿ç”¨ <code>producerNotifyConsumers</code> ä¸¦èª¿ç”¨ <code>node</code> çš„ <code>consumerMarkedDirty</code> æ–¹æ³•ã€‚å°‡ç¯€é»è¨­ç½®ç‚º dirty å’Œ <code>consumerMarkedDirty</code> æ–¹æ³•æ˜¯ç›®å‰æœ€é‡è¦çš„ã€‚è©²æ–¹æ³•åœ¨ <code>REACTIVE_LVIEW_CONSUMER_NODE</code> å®šç¾©ä¸­å®šç¾©ã€‚å®ƒä½¿ç”¨ <code>node.lView</code> åƒæ•¸èª¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/angular/angular/blob/21741384f4/packages/core/src/render3/util/view_utils.ts#L223-L243">markAncestorsForTraversal</a> å‡½æ•¸ã€‚é€™å°±æ˜¯ç‚ºä»€éº¼åœ¨éŸ¿æ‡‰å¼ç¯€é»ä¸­éœ€è¦ <code>lView</code> çš„åŸå› ã€‚å®ƒæ˜¯åœ¨ä¸Šé¢æåˆ°çš„ <code>borrowReactiveLViewConsumer</code> ä¸­åˆ†é…çš„ã€‚è®“æˆ‘å€‘æª¢æŸ¥ä¸€ä¸‹æ¨™è¨˜å‡½æ•¸ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">markAncestorsForTraversal</span>(<span class="params"><span class="attr">lView</span>: <span class="title class_">LView</span></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> parent = lView[<span class="variable constant_">PARENT</span>];</span><br><span class="line">  <span class="keyword">while</span> (parent !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// We stop adding markers to the ancestors once we reach one that already has the marker. This</span></span><br><span class="line">    <span class="comment">// is to avoid needlessly traversing all the way to the root when the marker already exists.</span></span><br><span class="line">    <span class="keyword">if</span> ((<span class="title function_">isLContainer</span>(parent) &amp;&amp; (parent[<span class="variable constant_">FLAGS</span>] &amp; <span class="title class_">LContainerFlags</span>.<span class="property">HasChildViewsToRefresh</span>) ||</span><br><span class="line">         (<span class="title function_">isLView</span>(parent) &amp;&amp; parent[<span class="variable constant_">FLAGS</span>] &amp; <span class="title class_">LViewFlags</span>.<span class="property">HasChildViewsToRefresh</span>))) &#123;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isLContainer</span>(parent)) &#123;</span><br><span class="line">      parent[<span class="variable constant_">FLAGS</span>] |= <span class="title class_">LContainerFlags</span>.<span class="property">HasChildViewsToRefresh</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// ğŸ‘‡</span></span><br><span class="line">      parent[<span class="variable constant_">FLAGS</span>] |= <span class="title class_">LViewFlags</span>.<span class="property">HasChildViewsToRefresh</span>;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="title function_">viewAttachedToChangeDetector</span>(parent)) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    parent = parent[<span class="variable constant_">PARENT</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è©²å‡½æ•¸æœƒä¿®æ”¹å¾ç•¶å‰ view åˆ°æ ¹ view çš„æ¯å€‹ view çš„ FLAGSã€‚å®ƒèˆ‡ <code>markForCheck</code> èª¿ç”¨ç™¼ç”Ÿçš„æƒ…æ³å¹¾ä¹ç›¸åŒï¼Œä½†æ¨™èªŒä¸åŒã€‚è®“æˆ‘å€‘æ¯”è¼ƒä¸€ä¸‹ã€‚<a target="_blank" rel="noopener" href="https://github.com/angular/angular/blob/21741384f4/packages/core/src/render3/view_ref.ts#L143-L145">ChangeDetectorRef</a> çš„ <a target="_blank" rel="noopener" href="https://github.com/angular/angular/blob/21741384f4/packages/core/src/render3/view_ref.ts#L143-L145">markForCheck</a> <a target="_blank" rel="noopener" href="https://github.com/angular/angular/blob/21741384f4/packages/core/src/render3/view_ref.ts#L143-L145">æ–¹æ³•</a>æœƒå°è‡´ <a target="_blank" rel="noopener" href="https://github.com/angular/angular/blob/21741384f4/packages/core/src/render3/instructions/mark_view_dirty.ts#L24C1-L36C2">markViewDirty</a> <a target="_blank" rel="noopener" href="https://github.com/angular/angular/blob/21741384f4/packages/core/src/render3/instructions/mark_view_dirty.ts#L24C1-L36C2">å·¥å…·</a>ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">markViewDirty</span>(<span class="params"><span class="attr">lView</span>: <span class="title class_">LView</span></span>): <span class="title class_">LView</span>|<span class="literal">null</span> &#123;</span><br><span class="line">  <span class="keyword">while</span> (lView) &#123;</span><br><span class="line">    <span class="comment">// ğŸ‘‡   </span></span><br><span class="line">    lView[<span class="variable constant_">FLAGS</span>] |= <span class="title class_">LViewFlags</span>.<span class="property">Dirty</span>;</span><br><span class="line">    <span class="keyword">const</span> parent = <span class="title function_">getLViewParent</span>(lView);</span><br><span class="line">    <span class="comment">// Stop traversing up as soon as you find a root view that wasn&#x27;t attached to any container</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isRootView</span>(lView) &amp;&amp; !parent) &#123;</span><br><span class="line">      <span class="keyword">return</span> lView;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// continue otherwise</span></span><br><span class="line">    lView = parent!;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ƒèˆ‡ <code>markAncestorsForTraversal</code> åŸ·è¡Œå¹¾ä¹ç›¸åŒçš„æ“ä½œï¼Œä½†æ¨™èªŒä¸åŒã€‚</p>
<p>æ‰€ä»¥ï¼Œè®“æˆ‘å€‘ç¢ºèªä¸€ä¸‹ç•¶ signal æ›´æ”¹æ™‚æœƒç™¼ç”Ÿä»€éº¼ï¼š</p>
<blockquote>
<p>ç•¶çµ„ä»¶æ¨¡æ¿ä¸­ä½¿ç”¨çš„ signal æ›´æ”¹æ™‚ï¼Œå®ƒæœƒé€šçŸ¥ view çš„éŸ¿æ‡‰å¼ live consumer æ›´æ”¹ã€‚é€™æœƒå°è‡´å°‡è©² consumer æ¨™è¨˜ç‚º dirtyã€‚æ­¤å¤–ï¼Œå®ƒæœƒå°‡å…¶æ‰€æœ‰ç¥–å…ˆæ¨™è¨˜ç‚ºå…·æœ‰ <code>HasChildViewsToRefresh</code> æ¨™èªŒï¼Œç›´åˆ°æ ¹ viewã€‚</p>
</blockquote>
<p>ç¾åœ¨ï¼Œæ­£å¦‚æ‚¨å·²ç¶“çŸ¥é“çš„ï¼Œchange detection æ©Ÿåˆ¶æœ‰å…©å€‹éƒ¨åˆ†ã€‚ç¬¬ä¸€éƒ¨åˆ†éœ€è¦ç¢ºå®šæ‡‰è©²æª¢æŸ¥å“ªäº› viewã€‚ç¬¬äºŒéƒ¨åˆ†æ˜¯éæ­· view çš„æ¨¹ã€‚è®“æˆ‘å€‘æª¢æŸ¥ç¬¬äºŒéƒ¨åˆ†ã€‚ç¬¬äºŒéƒ¨åˆ†ç”± <code>zone.js</code> è§¸ç™¼ã€‚</p>
<blockquote>
<p>å…¨åŸŸè‡ªä¸Šè€Œä¸‹çš„ change detection å‚³æ’­ä»ç„¶ç”± <code>zone.js</code> è§¸ç™¼</p>
</blockquote>
<p>æ¨¹éæ­·æ©Ÿåˆ¶å¦‚ä½•æ›´æ”¹ä»¥èˆ‡éŸ¿æ‡‰å¼ç³»çµ±äº’å‹•ï¼Ÿ</p>
<h2 id="éŸ¿æ‡‰å¼ç³»çµ±å¦‚ä½•å¯¦ç¾-Local-Change-Detectionï¼Ÿ"><a href="#éŸ¿æ‡‰å¼ç³»çµ±å¦‚ä½•å¯¦ç¾-Local-Change-Detectionï¼Ÿ" class="headerlink" title="éŸ¿æ‡‰å¼ç³»çµ±å¦‚ä½•å¯¦ç¾ Local Change Detectionï¼Ÿ"></a>éŸ¿æ‡‰å¼ç³»çµ±å¦‚ä½•å¯¦ç¾ Local Change Detectionï¼Ÿ</h2><p>è®“æˆ‘å€‘æª¢æŸ¥ä¸€ä¸‹åŸºæ–¼ signals çš„ç¬¬äºŒå€‹ç¯„ä¾‹è¨˜éŒ„äº†ä»€éº¼ï¼š</p>
<p><img src="https://miro.medium.com/v2/resize:fit:700/1*BbOFlDXj0nPHKRWCqk-boQ.png" alt="Image 35"></p>
<p>æ‚¨å¯ä»¥çœ‹åˆ°æ›´æ”¹å¾Œåªæœ‰ä¸€å€‹æ—¥èªŒã€‚çœ‹èµ·ä¾†åªæœ‰ TargetComponent çš„ä¸€å€‹æ¨¡æ¿å‡½æ•¸è¢«åŸ·è¡Œã€‚é€™æ­£æ˜¯ç™¼ç”Ÿçš„äº‹æƒ…ã€‚é€™å¯èƒ½æ˜¯å› ç‚º Angular æœ€è¿‘å°ä½¿ç”¨ signals çš„çµ„ä»¶é€²è¡Œäº†æ›´æ”¹ã€‚åœ¨ä¸Šä¸€ç¯€ä¸­ï¼Œæˆ‘å°‡æ‰€æœ‰å…§å®¹åˆ†è§£åˆ°æ‚¨å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ç•¶ signal æ›´æ”¹æ™‚ï¼Œå…¶ view å’Œæ‰€æœ‰çˆ¶ view ç›´åˆ°æ ¹ view éƒ½æœƒè¢«æ¨™è¨˜ä¸€å€‹ç‰¹æ®Šçš„æ¨™èªŒã€‚ç¾åœ¨ï¼Œè©²æ¨™èªŒå°‡ç”¨æ–¼æª¢æ¸¬æ˜¯å¦æ‡‰è©²æª¢æŸ¥çµ„ä»¶ï¼Œæˆ–è€…æ›å¥è©±èªªï¼Œæ˜¯å¦æ‡‰è©²åŸ·è¡Œ view çš„æ¨¡æ¿å‡½æ•¸ã€‚è®“æˆ‘å€‘è©³ç´°çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•é‹ä½œçš„ã€‚</p>
<p>signal çš„ç‹€æ…‹åœ¨å‚³éçµ¦ <code>setTimeout</code> èª¿ç”¨çš„å‡½æ•¸ä¸­æ›´æ”¹ã€‚é€™æ˜¯ä¸€å€‹éåŒæ­¥æ“ä½œï¼Œé€™è¡¨ç¤º <code>zone.js</code> çŸ¥é“è©²æ“ä½œã€‚Angular çš„æ ¸å¿ƒæœ‰ä¸€å€‹æ©Ÿåˆ¶å¯ä»¥è¿½è¹¤æ­¤é¡éåŒæ­¥æ“ä½œï¼Œä¸¦åœ¨é€™äº›æ“ä½œä¹‹å¾Œè§¸ç™¼å…¨åŸŸ change detection æ©Ÿåˆ¶ã€‚é€™ä¹Ÿç™¼ç”Ÿåœ¨æˆ‘å€‘çš„ç¯„ä¾‹ä¸­ã€‚é †ä¾¿èªªä¸€ä¸‹ï¼Œç„¡è«–æ‚¨æ˜¯å¦ä½¿ç”¨ signalsï¼Œ<code>zone.js</code> éƒ½æœƒè§¸ç™¼å…¨åŸŸ change detectionã€‚é€™å¯èƒ½æœƒåœ¨å°‡ä¾†ä½¿ç”¨ <code>signals: true</code> çµ„ä»¶æ™‚ç™¼ç”Ÿè®ŠåŒ–ï¼Œä½†å®ƒå€‘é‚„æ²’æœ‰ä¸Šç·šã€‚æ‰€ä»¥ï¼ŒAngular é–‹å§‹è‡ªä¸Šè€Œä¸‹åœ°éæ­· view çš„æ¨¹ã€‚ç¾åœ¨ï¼Œè«‹è¨˜ä½ <code>markAncestorsForTraversal</code>ã€‚å®ƒè¨­ç½®äº† <code>HasChildViewsToRefresh</code> æ¨™èªŒä¸¦å°‡ç›®æ¨™çµ„ä»¶ view æ¨™è¨˜ç‚º dirtyã€‚æ‚¨å¯ä»¥ç°¡å–®åœ°å˜—è©¦åœ¨ç¨‹å¼ç¢¼ä¸­æ‰¾åˆ°æ­¤æ¨™èªŒä¸¦æŸ¥çœ‹å®ƒåœ¨å“ªè£¡ä½¿ç”¨çš„ä¸€ç¨®æ–¹æ³•ã€‚å¦ä¸€ç¨®æ–¹æ³•æ˜¯æ‚¨å¯ä»¥å°‡ <code>debugger</code> èªå¥æ”¾å…¥ <code>TargetComponent</code> ä¸­çš„ <code>visualizeCd</code> getter ä¸­ã€‚è®“æˆ‘å€‘æª¢æŸ¥èª¿ç”¨å †ç–Šï¼š</p>
<p><img src="https://miro.medium.com/v2/resize:fit:700/1*ngYhSl4HcbZWGm0qHEAmYw.png" alt="Image 36"></p>
<p>æ‚¨å¯ä»¥çœ‹åˆ°ç†Ÿæ‚‰çš„ <code>refreshView</code> å’Œ <code>executeTemplate</code> å‡½æ•¸ã€‚æ‚¨é‚„å¯ä»¥çœ‹è¦‹ <code>TargetComponent_Template</code> å‡½æ•¸ï¼Œå®ƒæ˜¯æˆ‘å€‘ç›®æ¨™çµ„ä»¶çš„æ¨¡æ¿å‡½æ•¸ã€‚æ­¤å¤–ï¼Œé‚„æœ‰è¨±å¤šé¡ä¼¼ <code>detectChanges*</code> çš„å‡½æ•¸ï¼Œå®ƒå€‘æ˜¯ change detection æ©Ÿåˆ¶çš„ä¸€éƒ¨åˆ†ã€‚ç¥å¥‡çš„äº‹æƒ…ä¸€å®šç™¼ç”Ÿåœ¨å…¶ä¸­ä¸€å€‹å‡½æ•¸ä¸­ã€‚æ‚¨å¯ä»¥è§€å¯Ÿé‚£è£¡ç™¼ç”Ÿäº†ä»€éº¼ï¼Œæ‚¨å¯ä»¥æ‰“é–‹ç¯„ä¾‹ä¸¦å°‡ <code>debugger</code> èªå¥æ”¾å…¥ <code>visualizeCd</code> getter ä¸­ã€‚è®“æˆ‘å€‘å˜—è©¦åœ¨ç¨‹å¼ç¢¼ä¸­æœå°‹è©²æ¨™èªŒã€‚é †ä¾¿èªªä¸€ä¸‹ï¼Œæˆ‘å°æ‰€æœ‰ç¯„ä¾‹éƒ½ä½¿ç”¨ <code>21741384f4</code> æäº¤é›œæ¹Šã€‚ç¨‹å¼ç¢¼æœƒæ›´æ”¹ï¼Œå› æ­¤ç‚ºäº†ä¿æŒä¸€è‡´æ€§ä¸¦ä½¿æ‰€æœ‰é€£çµä¿æŒæœ‰æ•ˆï¼Œæˆ‘å°‡é¡¯ç¤ºä¾†è‡ªä¸€å€‹ç‰¹å®šæäº¤çš„æ‰€æœ‰å…§å®¹ã€‚æˆ‘ä½¿ç”¨ <code>.HasChildViewsToRefresh</code> æŸ¥è©¢é€²è¡Œæœå°‹ï¼Œæˆ‘èƒ½å¤ æ‰¾åˆ°å…©å€‹æª”æ¡ˆï¼š<code>view_utils.ts</code> å’Œ <code>instructions/change_detection.ts</code>ã€‚ç¬¬ä¸€å€‹æ˜¯å·¥å…·å‡½æ•¸ï¼Œç¬¬äºŒå€‹æ˜¯é—œæ–¼ change detection éç¨‹çš„ã€‚æˆ‘å€‘çµ•å°æƒ³æª¢æŸ¥ç¬¬äºŒå€‹ã€‚æ­¤å¤–ï¼Œç¬¬ä¸€å€‹å·²ç¶“å¾ˆç†Ÿæ‚‰äº†ï¼Œå› ç‚º <code>markAncestorsForTraversal</code> å·¥å…·å‡½æ•¸ä¾†è‡ªé‚£è£¡ã€‚<code>HasChildViewsToRefresh</code> åœ¨å…©å€‹å‡½æ•¸ä¸­ï¼š<code>detectChangesInView</code> å’Œ <code>detectChangesInEmbeddedViews</code>ã€‚ç¬¬äºŒå€‹å‡½æ•¸æ˜¯å¾ç¬¬ä¸€å€‹å‡½æ•¸ä¸­èª¿ç”¨çš„ã€‚è®“æˆ‘å€‘æª¢æŸ¥ä¸€ä¸‹å®ƒå€‘ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">detectChangesInView</span>(<span class="params"><span class="attr">lView</span>: <span class="title class_">LView</span>, <span class="attr">mode</span>: <span class="title class_">ChangeDetectionMode</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> isInCheckNoChangesPass = ngDevMode &amp;&amp; <span class="title function_">isInCheckNoChangesMode</span>();</span><br><span class="line">  <span class="keyword">const</span> tView = lView[<span class="variable constant_">TVIEW</span>];</span><br><span class="line">  <span class="keyword">const</span> flags = lView[<span class="variable constant_">FLAGS</span>];</span><br><span class="line">  <span class="keyword">const</span> consumer = lView[<span class="variable constant_">REACTIVE_TEMPLATE_CONSUMER</span>];</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">shouldRefreshView</span>: <span class="built_in">boolean</span> =</span><br><span class="line">      !!(mode === <span class="title class_">ChangeDetectionMode</span>.<span class="property">Global</span> &amp;&amp; flags &amp; <span class="title class_">LViewFlags</span>.<span class="property">CheckAlways</span>);</span><br><span class="line">  shouldRefreshView ||= !!(</span><br><span class="line">      flags &amp; <span class="title class_">LViewFlags</span>.<span class="property">Dirty</span> &amp;&amp; mode === <span class="title class_">ChangeDetectionMode</span>.<span class="property">Global</span> &amp;&amp; !isInCheckNoChangesPass);</span><br><span class="line">  shouldRefreshView ||= !!(flags &amp; <span class="title class_">LViewFlags</span>.<span class="property">RefreshView</span>);</span><br><span class="line">  <span class="comment">// Refresh views when they have a dirty reactive consumer, regardless of mode.</span></span><br><span class="line">  <span class="comment">// ğŸ‘‡</span></span><br><span class="line">  shouldRefreshView ||= !!(consumer?.<span class="property">dirty</span> &amp;&amp; <span class="title function_">consumerPollProducersForChange</span>(consumer));<span class="keyword">if</span> (consumer) &#123;</span><br><span class="line">    consumer.<span class="property">dirty</span> = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  lView[<span class="variable constant_">FLAGS</span>] &amp;= ~(<span class="title class_">LViewFlags</span>.<span class="property">HasChildViewsToRefresh</span> | <span class="title class_">LViewFlags</span>.<span class="property">RefreshView</span>);</span><br><span class="line">  <span class="keyword">if</span> (shouldRefreshView) &#123;</span><br><span class="line">    <span class="comment">// ğŸ‘‡</span></span><br><span class="line">    <span class="title function_">refreshView</span>(tView, lView, tView.<span class="property">template</span>, lView[<span class="variable constant_">CONTEXT</span>]);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (flags &amp; <span class="title class_">LViewFlags</span>.<span class="property">HasChildViewsToRefresh</span>) &#123;</span><br><span class="line">    <span class="comment">// ğŸ‘‡</span></span><br><span class="line">    <span class="title function_">detectChangesInEmbeddedViews</span>(lView, <span class="title class_">ChangeDetectionMode</span>.<span class="property">Targeted</span>);</span><br><span class="line">    <span class="keyword">const</span> components = tView.<span class="property">components</span>;</span><br><span class="line">    <span class="keyword">if</span> (components !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// ğŸ‘‡</span></span><br><span class="line">      <span class="title function_">detectChangesInChildComponents</span>(lView, components, <span class="title class_">ChangeDetectionMode</span>.<span class="property">Targeted</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">detectChangesInEmbeddedViews</span>(<span class="params"><span class="attr">lView</span>: <span class="title class_">LView</span>, <span class="attr">mode</span>: <span class="title class_">ChangeDetectionMode</span></span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> lContainer = <span class="title function_">getFirstLContainer</span>(lView); lContainer !== <span class="literal">null</span>;</span><br><span class="line">       lContainer = <span class="title function_">getNextLContainer</span>(lContainer)) &#123;</span><br><span class="line">    lContainer[<span class="variable constant_">FLAGS</span>] &amp;= ~<span class="title class_">LContainerFlags</span>.<span class="property">HasChildViewsToRefresh</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="variable constant_">CONTAINER_HEADER_OFFSET</span>; i &lt; lContainer.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> embeddedLView = lContainer[i];</span><br><span class="line">      <span class="title function_">detectChangesInViewIfAttached</span>(embeddedLView, mode);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¦éš›ä¸Šï¼Œé€™äº›å‡½æ•¸è§£é‡‹äº†ä¸€åˆ‡ã€‚é€™äº›å‡½æ•¸åœ¨æ‡‰ç”¨ç¨‹å¼ä¸­çš„æ¯å€‹ view ä¸Šéè¿´èª¿ç”¨ã€‚ç•¶ Angular åŸ·è¡Œ change detection éç¨‹æ™‚ï¼Œå®ƒæœƒéæ­·æ¯å€‹ view ä¸¦èª¿ç”¨è©²ç¨‹å¼ç¢¼ã€‚å¾å‰é¢çš„ç« ç¯€ä¸­ï¼Œæ‚¨çŸ¥é“åœ¨ signal æ›´æ”¹çš„æƒ…æ³ä¸‹ï¼Œview æœƒè¢«æ¨™è¨˜ <code>HasChildViewsToRefresh</code> æ¨™èªŒã€‚æ­¤å¤–ï¼Œæ¯å€‹ view éƒ½æœ‰ä¸€å€‹å¯ä»¥ç‚º dirty çš„éŸ¿æ‡‰å¼ consumerã€‚é‚£è£¡ç™¼ç”Ÿäº†ä»€éº¼ï¼Ÿè®“æˆ‘å€‘ä¾†è©³ç´°èªªæ˜ã€‚</p>
<p>æˆ‘æ­£åœ¨å˜—è©¦ï¼ˆæˆ‘çœŸçš„åœ¨åŠªåŠ›ï¼Œå„ä½ï¼‰ç°¡åŒ–äº‹æƒ…ã€‚å¦ç‡åœ°èªªï¼ŒAngular æœ‰å…©ç¨®é¡å‹çš„ viewï¼Œä¸¦ä¸”å®ƒåŒæ™‚ä½¿ç”¨å®ƒå€‘ï¼š<code>tView</code> å’Œ <code>lView</code>ã€‚ç‚ºäº†ç°¡åŒ–ï¼Œè®“æˆ‘å€‘ç¾åœ¨å°ˆæ³¨æ–¼å·²çŸ¥çš„æ¨™èªŒï¼Œæˆ‘çœç•¥äº† <code>detectChangesInView</code> å‡½æ•¸çš„æŸäº›éƒ¨åˆ†ã€‚å› ç‚ºé€™ç¯‡æ–‡ç« ä¸æ˜¯é—œæ–¼ change detection çš„ã€‚</p>
<p>é¦–å…ˆï¼Œè©²å‡½æ•¸æª¢æ¸¬æ˜¯å¦æ‡‰è©²åˆ·æ–° viewã€‚å®ƒæª¢æŸ¥ view å’Œæ¨¡å¼çš„ä¸åŒæ¨™èªŒã€‚è®“æˆ‘å€‘æª¢æŸ¥ä¸€ä¸‹é€™äº›è¡Œï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">shouldRefreshView ||= !!(</span><br><span class="line">                       ğŸ‘‡</span><br><span class="line">      flags &amp; <span class="title class_">LViewFlags</span>.<span class="property">Dirty</span> &amp;&amp; mode === <span class="title class_">ChangeDetectionMode</span>.<span class="property">Global</span> &amp;&amp; !isInCheckNoChangesPass);</span><br><span class="line"></span><br><span class="line">shouldRefreshView ||=</span><br><span class="line">                ğŸ‘‡</span><br><span class="line">    !!(consumer?.<span class="property">dirty</span> &amp;&amp; <span class="title function_">consumerPollProducersForChange</span>(consumer));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€å€‹è¡¨é”å¼æª¢æŸ¥ view æ˜¯å¦å…·æœ‰ <code>LViewFlags.Dirty</code> æ¨™èªŒå’Œ <code>mode</code>ã€‚æˆ‘å°‡åœ¨é€™ç¯‡æ–‡ç« ä¸­ç°¡åŒ– <code>mode</code> éƒ¨åˆ†ã€‚åœ¨ <code>OnPush</code> + <code>markForCheck</code> æ¨¡å¼çš„æƒ…æ³ä¸‹ï¼Œæ‚¨é€šå¸¸æœƒä½¿ç”¨ <code>ChangeDetectionMode.Global</code>ã€‚åœ¨ä½¿ç”¨ signals æ¨¡å¼å’Œç²¾ç´°æ›´æ–°çš„æƒ…æ³ä¸‹ï¼Œæ‚¨å°‡ä½¿ç”¨ <code>ChangeDetectionMode.Targeted</code>ã€‚<code>flags &amp; LViewFlags.Dirty</code> æ˜¯ä¸€å€‹æŒ‰ä½é‹ç®—ï¼Œè©²æ©Ÿåˆ¶åœ¨ Angular ä¸­ç”¨æ–¼åŸ·è¡Œæ¥µå¿«çš„æª¢æŸ¥ã€‚ç¬¬ä¸€å€‹è¡¨é”å¼æ˜¯é—œæ–¼ <code>Dirty</code> æ¨™èªŒçš„ï¼Œæˆ‘ä¹‹å‰æåˆ°å®ƒåœ¨ <code>ChangeDetectorRef</code> çš„ <code>markForCheck</code> æ–¹æ³•ä¸­ä½¿ç”¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœå®ƒè¢«æ¨™è¨˜ç‚ºéœ€è¦æª¢æŸ¥ï¼Œå®ƒå°‡ç‚º trueï¼Œä½†ç¾åœ¨æƒ…æ³ä¸¦éå¦‚æ­¤ã€‚</p>
<blockquote>
<p>å¦‚æœ view è¢«æ¨™è¨˜äº† RefreshView æ¨™èªŒï¼ŒAngular æœƒåŸ·è¡Œæ¨¡æ¿å‡½æ•¸ã€‚é€™æ˜¯ <code>markViewDirty</code> èª¿ç”¨ï¼ˆ<code>ChangeDetectorRef</code> çš„ <code>markForCheck</code>ï¼‰çš„æƒ…æ³ã€‚</p>
</blockquote>
<p>ç¬¬äºŒå€‹è¡¨é”å¼æª¢æŸ¥ view çš„éŸ¿æ‡‰å¼ consumer æ˜¯å¦ç‚º dirtyã€‚åœ¨æˆ‘çš„ç¬¬äºŒå€‹ä½¿ç”¨ signals çš„ç¯„ä¾‹ä¸­ï¼Œview çš„éŸ¿æ‡‰å¼ç¯€é»è¢«æ¨™è¨˜ç‚º dirtyã€‚å®ƒç™¼ç”Ÿåœ¨ <code>state</code> signal æ›´æ”¹æ™‚ï¼Œview çš„éŸ¿æ‡‰å¼ç¯€é»è¢«é€šçŸ¥ä¸¦ä¸”å®ƒè®Šç‚º dirtyã€‚å› æ­¤ï¼Œç•¶ Angular éæ­·åˆ°è©² view æ™‚ï¼Œæ­¤æª¢æŸ¥å°‡åœ¨è©² view ä¸Šè¿”å› trueã€‚</p>
<blockquote>
<p>å¦‚æœ view çš„éŸ¿æ‡‰å¼ç¯€é»è¢«æ¨™è¨˜ç‚º dirtyï¼ŒAngular æœƒåŸ·è¡Œæ¨¡æ¿å‡½æ•¸ã€‚ç•¶æ¨¡æ¿ä¸­ä½¿ç”¨çš„ä»»ä½• signals ç”±æ–¼éŸ¿æ‡‰å¼ä¾è³´é …åœ–è€Œæ›´æ–°æ™‚ï¼Œå°±æœƒç™¼ç”Ÿé€™ç¨®æƒ…æ³ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚ï¼Œåœ¨ computed signal çš„æƒ…æ³ä¸‹ï¼Œéœ€è¦ <code>consumerPollProducersForChange(consumer)</code> éƒ¨åˆ†ã€‚å¾æ·±å…¥æ¢è¨çš„ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œæ‚¨å¯èƒ½é‚„è¨˜å¾—ï¼ˆå¦‚æœæ‚¨é‚„æ²’æœ‰é–±è®€ï¼Œè«‹æŸ¥çœ‹å®ƒï¼›å®ƒå¾ˆé…·ï¼Œæ‚¨æœƒè®“æˆ‘é«˜èˆˆ :)) å¯èƒ½å­˜åœ¨è¤‡é›œçš„æƒ…æ³ã€‚è®“æˆ‘å€‘æª¢æŸ¥ä¸€ä¸‹é‚£éƒ¨åˆ†ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lView[<span class="variable constant_">FLAGS</span>] &amp;= ~(<span class="title class_">LViewFlags</span>.<span class="property">HasChildViewsToRefresh</span> | <span class="title class_">LViewFlags</span>.<span class="property">RefreshView</span>);</span><br></pre></td></tr></table></figure>

<p>é€™ä¹Ÿæ˜¯ä¸€å€‹æŒ‰ä½é‹ç®—ç¬¦ã€‚å®ƒå¾ view ä¸­åˆªé™¤äº† <code>HasChildViewsToRefresh</code> å’Œ <code>RefreshView</code> æ¨™èªŒã€‚ä¹‹å¾Œï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä¸€å€‹ <code>if &#123;&#125; else &#123;&#125;</code> æ¢ä»¶ã€‚è®“æˆ‘å€‘æª¢æŸ¥ä¸€ä¸‹å®ƒï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (shouldRefreshView) &#123;</span><br><span class="line">    <span class="title function_">refreshView</span>(tView, lView, tView.<span class="property">template</span>, lView[<span class="variable constant_">CONTEXT</span>]);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (flags &amp; <span class="title class_">LViewFlags</span>.<span class="property">HasChildViewsToRefresh</span>) &#123;</span><br><span class="line">    <span class="title function_">detectChangesInEmbeddedViews</span>(lView, <span class="title class_">ChangeDetectionMode</span>.<span class="property">Targeted</span>);</span><br><span class="line">    <span class="keyword">const</span> components = tView.<span class="property">components</span>;</span><br><span class="line">    <span class="keyword">if</span> (components !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="title function_">detectChangesInChildComponents</span>(lView, components, <span class="title class_">ChangeDetectionMode</span>.<span class="property">Targeted</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ <code>shouldRefreshView</code> ç‚º <code>true</code> çš„æƒ…æ³ä¸‹ï¼Œå®ƒæœƒè½‰åˆ° <code>refreshView</code> æ–¹æ³•ä¸¦åŸ·è¡Œæ¨¡æ¿ã€‚åœ¨æˆ‘å€‘çš„ç¯„ä¾‹ä¸­ï¼Œç•¶ç›®æ¨™çµ„ä»¶ä¸­çš„ <code>state</code> signal çš„ç‹€æ…‹æ›´æ–°æ™‚ï¼Œå°±æœƒåŸ·è¡Œæ­¤æ“ä½œã€‚</p>
<p>å¦å‰‡ï¼Œå®ƒæœƒæª¢æŸ¥ view æ˜¯å¦å…·æœ‰ <code>HasChildViewsToRefresh</code> æ¨™èªŒã€‚æ­¤æ¨™èªŒåœ¨ <code>markAncestorsForTraversal</code> å‡½æ•¸ä¸­è¨­ç½®ã€‚å¦‚æœæ˜¯ï¼Œå®ƒæœƒç¹¼çºŒæª¢æŸ¥å­é …è€Œä¸åŸ·è¡Œæ¨¡æ¿å‡½æ•¸ã€‚<code>else if</code> åˆ†æ”¯ä¸­çš„å…©å€‹å‡½æ•¸éƒ½å°‡å†æ¬¡å°è‡´ <code>detectChangesInView</code> å‡½æ•¸ã€‚å®ƒä»¥éè¿´æ–¹å¼å·¥ä½œï¼Œä¸¦å°‡åœ¨ç•¶å‰ view çš„æ¯å€‹å­é …ä¸Šèª¿ç”¨ï¼Œä¾æ­¤é¡æ¨ã€‚</p>
<p>è®“æˆ‘å€‘ç¸½çµä¸€ä¸‹ã€‚ç•¶åœ¨çµ„ä»¶ä¸­æ›´æ–° signal æ™‚ï¼Œé€™æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p>
<ol>
<li>åœ¨çµ„ä»¶ä¸­æ›´æ–° signal ä½œç‚ºéåŒæ­¥æ“ä½œï¼ˆå¦‚ <code>setTimeout</code>ï¼‰çš„ä¸€éƒ¨åˆ†ã€‚</li>
<li>Angular è‡ªä¸Šè€Œä¸‹è§¸ç™¼å…¨åŸŸ change detectionã€‚</li>
<li>ä½œç‚ºå…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨æ‡‰ç”¨ç¨‹å¼ä¸­ view æ¨¹çš„æ¯å€‹ view ä¸Šèª¿ç”¨ <code>detectChangesInView</code>ã€‚</li>
<li>å®ƒæª¢æŸ¥ view çš„ consumer æ˜¯å¦ç‚º dirty æˆ–å…¶ä¾è³´é …æ˜¯å¦å·²æ›´æ”¹ï¼Œå¦‚æœç‚º trueï¼Œå‰‡åŸ·è¡Œæ¨¡æ¿ã€‚</li>
<li>å¦‚æœä¸æ˜¯ï¼Œå®ƒæœƒæª¢æŸ¥ view ä¸Šæ˜¯å¦æœ‰ <code>HasChildViewsToRefresh</code> æ¨™èªŒï¼Œé€™è¡¨ç¤º Angular å¿…é ˆç¹¼çºŒæª¢æŸ¥å­é …ã€‚åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œå®ƒä¸æœƒåŸ·è¡Œ view çš„æ¨¡æ¿ã€‚å®ƒæœƒè·³éå®ƒã€‚</li>
<li>å¦‚æœç”±æ–¼ signal æ›´æ”¹è€Œæ¨™è¨˜äº† viewï¼ŒAngular ä¸æœƒåœ¨æ¯å€‹ view ä¸ŠåŸ·è¡Œæ¨¡æ¿å‡½æ•¸ã€‚</li>
<li>æ­¤å¤–ï¼Œè«‹æ³¨æ„ï¼Œåœ¨ <code>Dirty</code> æ¨™èªŒçš„æƒ…æ³ä¸‹ï¼Œæ­¤å‡½æ•¸ä¸æœƒè½‰åˆ°å­ viewã€‚å®ƒåªæ˜¯åœæ­¢åŸ·è¡Œ <code>detectChangesInView</code> ä¸¦é€€å‡ºã€‚é€™å°±æ˜¯åœ¨ <code>markForCheck</code> æ–¹æ³•çš„æƒ…æ³ä¸‹å¦‚ä½•åˆ‡æ–· view åˆ†æ”¯ã€‚</li>
</ol>
<p>è©²æ¼”ç®—æ³•åœ¨æ¨¹ä¸­çš„æ¯å€‹ view ä¸ŠåŸ·è¡Œã€‚åœ¨ä»¥ä¸‹æƒ…æ³ä¸‹ï¼Œç•¶åœ¨</p>
<p>é‡é»èªªæ˜ï¼š</p>
<blockquote>
<p>åœ¨ä½¿ç”¨ signals çš„æƒ…æ³ä¸‹ï¼ŒChange detection çš„å·¥ä½œæ–¹å¼æ›´å„ªåŒ–ï¼Œå› ç‚º Angular ä¸æœƒåœ¨æ¨™è¨˜çš„ view é›†åˆä¸­çš„æ¯å€‹ view ä¸ŠåŸ·è¡Œæ¨¡æ¿å‡½æ•¸ã€‚å®ƒä»¥ç²¾ç´°çš„æ–¹å¼åŸ·è¡Œæ­¤æ“ä½œã€‚å®ƒåƒ…é‡å°å…¶éŸ¿æ‡‰å¼ç¯€é»ç‚º dirty çš„ view åŸ·è¡Œæ¨¡æ¿å‡½æ•¸ã€‚</p>
</blockquote>
<h2 id="ä¸€å€‹æº«å’Œä½†é‡è¦çš„èªªæ˜"><a href="#ä¸€å€‹æº«å’Œä½†é‡è¦çš„èªªæ˜" class="headerlink" title="ä¸€å€‹æº«å’Œä½†é‡è¦çš„èªªæ˜"></a>ä¸€å€‹æº«å’Œä½†é‡è¦çš„èªªæ˜</h2><p>ç•¶çµ„ä»¶ä½¿ç”¨ <code>OnPush</code> ç­–ç•¥æ™‚ï¼Œæœ‰å¹¾ç¨®æ–¹æ³•å¯ä»¥æ¨™è¨˜ view ä»¥é€²è¡Œæª¢æŸ¥ã€‚å®ƒå€‘åœ¨æ‡‰ç”¨ç¨‹å¼ä¸­ç¶“å¸¸ä½¿ç”¨ï¼Œå› æ­¤çµ„ä»¶å¯ä»¥ç›¸äº’é€šè¨Šã€‚æ­¤å¤–ï¼Œåƒ <code>(click)</code> é€™æ¨£çš„ DOM äº‹ä»¶ä¹Ÿæœƒå‡ºç¾åœ¨é‚£è£¡ã€‚<a target="_blank" rel="noopener" href="https://github.com/angular/angular/blob/21741384f46012f7e8cdbab03281b664b9b954cb/packages/core/src/render3/instructions/listener.ts#L260">æœ‰ä¸€æ®µç¨‹å¼ç¢¼</a>åœ¨è¼¸å‡ºçš„æƒ…æ³ä¸‹å°‡ view åŠå…¶çˆ¶é …æ¨™è¨˜ç‚º dirtyã€‚å¦ä¸€æ–¹é¢ï¼Œé‚„æœ‰è¨±å¤šæ±è¥¿ï¼Œå¦‚ WebSocketsã€Server-Side Eventsã€é€šéæœå‹™é€²è¡Œé€šè¨Šå’Œè¨ˆæ™‚å™¨ã€‚å› æ­¤ï¼Œåœ¨ç·¨å¯«æ‡‰ç”¨ç¨‹å¼æ™‚ï¼Œè«‹è€ƒæ…®æ­¤ç´°ç¯€ã€‚è®“æˆ‘å€‘çœ‹çœ‹ Angular åœ˜éšŠåœ¨æœªä¾†ç‰ˆæœ¬ä¸­å‘æˆ‘å€‘æå‡ºäº†ä»€éº¼å»ºè­°ã€‚æ ¹æ“š RFCï¼Œçœ‹èµ·ä¾†æœªä¾†å°‡æœƒæœ‰æ›´å¤šæœ‰è¶£çš„å·¥å…·ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘å€‘ä»Šå¤©è¨è«–äº†ä»€éº¼ï¼š</p>
<ul>
<li>âœ… Angular å¦‚ä½•åœ¨ Angular Signals ä¹‹ä¸Šæ§‹å»º Local Change Detection æ©Ÿåˆ¶ï¼Ÿ</li>
<li>âœ… å®ƒå¦‚ä½•å°‡ Angular Signals é›†æˆåˆ°ç¾æœ‰çš„ change detection æ©Ÿåˆ¶ä¸­ï¼Ÿ</li>
<li>âœ… ç•¶åœ¨çµ„ä»¶çš„æ¨¡æ¿ä¸­ä½¿ç”¨ signal æ™‚æœƒç™¼ç”Ÿä»€éº¼ï¼Ÿ</li>
</ul>
<p>ç¸½ä¹‹ï¼Œé€™å°±æ˜¯æˆ‘æƒ³èªªçš„é—œæ–¼ä½¿ç”¨ Angular Signals å¯¦ç¾çš„ Local change detection æ©Ÿåˆ¶çš„æ‰€æœ‰å…§å®¹ã€‚æˆ‘èªç‚ºé€™æ˜¯ Angular æ¼”é€²ä¸­çš„é‡è¦ä¸€æ­¥ï¼Œåˆ†è§£é€™éƒ¨åˆ†å…§å®¹çœŸæ˜¯å¤ªæ£’äº† ğŸš€ã€‚æ„Ÿè¬ä¾†è‡ª AngularWave çš„ <a target="_blank" rel="noopener" href="https://twitter.com/marsibarsi">Roman Sedov</a> å’Œ <a target="_blank" rel="noopener" href="https://twitter.com/Waterplea">Alex Inkin</a> çš„å¯©é–±ã€‚é€™æœ‰å¾ˆå¤§å¹«åŠ©ï¼è«‹ç¹¼çºŒé—œæ³¨<a target="_blank" rel="noopener" href="https://twitter.com/sharikov_vlad">æˆ‘çš„ Twitter</a>ï¼Œä¸‹æ¬¡è¦‹ï¼</p>

      
    </div>
      
      <footer>
        
        
        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
      </footer>
  </div>
</article>


<section id="comment">
  
</section>


</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="æœå°‹">
    <input type="hidden" name="q" value="site:viaje9.github.io">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">æœ€æ–°æ–‡ç« </h3>
  <ul class="entry">
    
      <li>
        <a href="/TranslationKonjac/2025/04/05/zh-tw-How-to-Get-Rich/">å¦‚ä½•è‡´å¯Œï¼ˆä¸é é‹æ°£ï¼‰</a>
      </li>
    
      <li>
        <a href="/TranslationKonjac/2025/02/17/zh-tw-change-detection-and-component-trees-in-angular-applications/">Angular æ‡‰ç”¨ç¨‹å¼ä¸­çš„è®Šæ›´åµæ¸¬èˆ‡å…ƒä»¶æ¨¹</a>
      </li>
    
      <li>
        <a href="/TranslationKonjac/2025/01/20/zh-tw-local-change-detection-and-angular-signals-in-templates-in-details/">å±€éƒ¨è®Šæ›´åµæ¸¬èˆ‡ Angular Signals åœ¨æ¨¡æ¿ä¸­çš„è©³ç´°æ‡‰ç”¨</a>
      </li>
    
      <li>
        <a href="/TranslationKonjac/2025/01/19/zh-tw-running-change-detection-components-tree/">åŸ·è¡Œè®Šæ›´åµæ¸¬ â€“ å…ƒä»¶æ¨¹</a>
      </li>
    
      <li>
        <a href="/TranslationKonjac/2025/01/13/zh-tw-change-detection-big-picture-unidirectional-data-flow/">è®Šæ›´åµæ¸¬å¤§è§€ â€“ å–®å‘æ•¸æ“šæµ</a>
      </li>
    
  </ul>
</div>


  

  
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2025 Brian
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



</body>
</html>

